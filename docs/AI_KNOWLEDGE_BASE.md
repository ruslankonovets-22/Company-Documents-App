# ü§ñ AI Knowledge Base - Company Documents App

**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** v0.0.2.4  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-22  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Comprehensive guide –¥–ª—è –æ–±—É—á–µ–Ω–∏—è AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º

---

## üìö –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û –ø—Ä–æ–µ–∫—Ç–µ](#1-–æ-–ø—Ä–æ–µ–∫—Ç–µ)
2. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#2-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#3-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
4. [Frappe Framework v15 - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#4-frappe-framework-v15---–∫—Ä–∏—Ç–∏—á–Ω—ã–µ-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
5. [Fixtures - –≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö](#5-fixtures---—ç–∫—Å–ø–æ—Ä—Ç-–∏-–∏–º–ø–æ—Ä—Ç-–¥–∞–Ω–Ω—ã—Ö)
6. [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#6-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞-–∏-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [NextCloud –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#7-nextcloud-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
8. [–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è](#8-—Ç–∏–ø–∏—á–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã-–∏-—Ä–µ—à–µ–Ω–∏—è)
9. [Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#9-workflow-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
10. [–ß–µ–∫-–ª–∏—Å—Ç—ã –¥–ª—è AI](#10-—á–µ–∫-–ª–∏—Å—Ç—ã-–¥–ª—è-ai)

---

## 1. –û –ø—Ä–æ–µ–∫—Ç–µ

### 1.1 –ß—Ç–æ —Ç–∞–∫–æ–µ Company Documents App?

**Company Documents App** - –∫–∞—Å—Ç–æ–º–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è ERPNext, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–µ–µ:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π (`DOC-2025-00001`)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ —Å NextCloud —á–µ—Ä–µ–∑ WebDAV (—Å–∞–º–æ–ø–∏—Å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, 636 —Å—Ç—Ä–æ–∫)
- –ì–∏–±–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ (5 —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏)
- –°–≤—è–∑—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏ ERPNext

### 1.2 –¢–µ–∫—É—â–∞—è —Å—Ç–∞–¥–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–í–µ—Ä—Å–∏—è:** v0.0.2.4 (Development Stage)

**–§–∏–ª–æ—Å–æ—Ñ–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - –ü–û–õ–ò–ì–û–ù:**
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è - –≤—Å–µ–≥–¥–∞ —á–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚ùå Production deployment - –ø–æ–∫–∞ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

**–í–∞–∂–Ω–æ:** –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—á–Ω—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å –≤–µ—Ä—Å–∏–∏ v1.0.0+

### 1.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
Company-Documents-App/
‚îú‚îÄ‚îÄ company_documents/              # –û—Å–Ω–æ–≤–Ω–æ–π Python –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                 # –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ hooks.py                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Frappe hooks
‚îÇ   ‚îú‚îÄ‚îÄ nextcloud_sync.py           # NextCloud —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (636 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ modules.txt                 # –°–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π (Documents)
‚îÇ   ‚îú‚îÄ‚îÄ patches.txt                 # –ú–∏–≥—Ä–∞—Ü–∏–∏ (–ø—É—Å—Ç–æ –≤ v0.0.2)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ fixtures/                   # –î–∞–Ω–Ω—ã–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ doctype.json            # 9 DocTypes (~87 KB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server_script.json      # 5 Server Scripts (~18 KB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client_script.json      # 7 Client Scripts (~12 KB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ folder_structure_template.json  # 45 —à–∞–±–ª–æ–Ω–æ–≤ (~17 KB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ custom_field.json       # Custom Fields (2 –±–∞–π—Ç - –ø—É—Å—Ç–æ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ property_setter.json    # Property Setters (2 –±–∞–π—Ç - –ø—É—Å—Ç–æ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ document_naming_rule.json  # –ü—Ä–∞–≤–∏–ª–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ (296 –±–∞–π—Ç)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ workspace.json          # UI –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã (~2.5 KB)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ config/                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ custom/                     # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ document.py             # Document controller
‚îÇ   ‚îú‚îÄ‚îÄ documents/                  # –ú–æ–¥—É–ª—å Documents
‚îÇ   ‚îú‚îÄ‚îÄ templates/                  # Jinja2 —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ public/                     # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ
‚îú‚îÄ‚îÄ docs/                           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ AI_KNOWLEDGE_BASE.md        # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md             # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (~463 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ DEVELOPMENT.md              # –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ FIXTURES.md                 # –†–∞–±–æ—Ç–∞ —Å fixtures
‚îÇ   ‚îú‚îÄ‚îÄ NEXTCLOUD_SYNC.md           # NextCloud –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ DOCKER_SETUP.md             # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ copilot/
‚îÇ       ‚îú‚îÄ‚îÄ GUIDELINES.md           # –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è AI
‚îÇ       ‚îî‚îÄ‚îÄ COMMON_COMMANDS.md      # –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îÇ
‚îú‚îÄ‚îÄ scripts/                        # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ validate_fst_order.py       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—è–¥–∫–∞ FST
‚îÇ   ‚îú‚îÄ‚îÄ fix_fst_order.py            # –ê–≤—Ç–æ—Ñ–∏–∫—Å –ø–æ—Ä—è–¥–∫–∞ FST
‚îÇ   ‚îî‚îÄ‚îÄ pre-commit-hook.sh          # Git hook –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ CHANGELOG.md                    # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ README.md                       # –ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ knowledge.md                    # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îî‚îÄ‚îÄ pyproject.toml                  # Python –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```

---

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### 2.1 –¢–æ—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ (–ö–†–ò–¢–ò–ß–ù–û!)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|----------|-------------|
| **Frappe Framework** | version-15 | [GitHub](https://github.com/frappe/frappe/tree/version-15) | ‚ö†Ô∏è –ù–ï v14, –ù–ï v16! |
| **ERPNext** | v15.83.0 | [GitHub](https://github.com/frappe/erpnext/tree/v15.83.0) | –¢–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è |
| **HRMS** | v15.52.0 | [GitHub](https://github.com/frappe/hrms/tree/v15.52.0) | HR –º–æ–¥—É–ª—å |
| **Raven** | v2.6.4 | [GitHub](https://github.com/The-Commit-Company/raven/tree/v2.6.4) | –ß–∞—Ç |
| **pibiDAV** | version-15 | [GitHub](https://github.com/pibico/pibidav/tree/version-15) | WebDAV (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é) |
| **Python** | 3.10+ | - | –ú–∏–Ω–∏–º—É–º 3.10 |
| **MariaDB** | 10.6 | - | –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å Frappe v15 |
| **Redis** | 7.0+ | - | –ö—ç—à –∏ –æ—á–µ—Ä–µ–¥–∏ |
| **Node.js** | 18+ | - | –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ |
| **Docker** | 24+ | - | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è |
| **NextCloud** | latest | - | –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |

### 2.2 apps.json –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```json
[
  {"url": "https://github.com/frappe/erpnext", "branch": "v15.83.0"},
  {"url": "https://github.com/frappe/hrms", "branch": "v15.52.0"},
  {"url": "https://github.com/The-Commit-Company/raven", "branch": "v2.6.4"},
  {"url": "https://github.com/pibico/pibidav", "branch": "version-15"},
  {"url": "https://github.com/ruslankonovets-22/Company-Documents-App", "branch": "main"}
]
```

**‚ö†Ô∏è –ü–û–†–Ø–î–û–ö –ö–†–ò–¢–ò–ß–ï–ù!** company_documents —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º —á–µ—Ä–µ–∑ Git.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** pibidav –≤–∫–ª—é—á–µ–Ω –≤ apps.json –Ω–æ –Ω–∞–ø—Ä—è–º—É—é –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∞–º–æ–ø–∏—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è NextCloud (636 —Å—Ç—Ä–æ–∫).

### 2.3 –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### Frappe Framework v15
- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç:** https://frappeframework.com/
- **GitHub:** https://github.com/frappe/frappe/tree/version-15
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://frappeframework.com/docs/v15/user
- **API Reference:** https://frappeframework.com/docs/v15/api
- **Migration Guide v14‚Üív15:** https://github.com/frappe/frappe/wiki/Migrating-to-Version-15

#### ERPNext v15
- **GitHub:** https://github.com/frappe/erpnext/tree/v15.83.0
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://docs.erpnext.com/
- **User Manual:** https://docs.erpnext.com/docs/v15/user/manual/en

#### NextCloud WebDAV
- **WebDAV API:** https://docs.nextcloud.com/server/stable/developer_manual/client_apis/WebDAV/
- **Files API:** https://docs.nextcloud.com/server/latest/developer_manual/client_apis/WebDAV/files.html

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 3.1 DocTypes (5 —Ç–∏–ø–æ–≤)

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –£–¥–∞–ª–µ–Ω—ã 4 legacy DocTypes –∏–∑ –º–æ–¥—É–ª—è Projects (Project Document Type, Task Employee, CILA Document Row, Task Workspace Row) - –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è!

#### 3.1.1 Document (–û—Å–Ω–æ–≤–Ω–æ–π DocType)

**–¢–∏–ø:** Document  
**–ú–æ–¥—É–ª—å:** Documents  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —Ñ–∞–π–ª–∞–º–∏

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `name` | Data | –ê–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏—è: `DOC-2025-00001` |
| `project` | Link (Project) | –°–≤—è–∑—å —Å –ø—Ä–æ–µ–∫—Ç–æ–º |
| `task` | Link (Task) | –°–≤—è–∑—å —Å –∑–∞–¥–∞—á–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `level_1` –¥–æ `level_5` | Link (Folder Structure Template) | 5 —É—Ä–æ–≤–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫ |
| `files` | Table (Document File) | Child table —Å —Ñ–∞–π–ª–∞–º–∏ |

**Hooks —Å–æ–±—ã—Ç–∏—è:**
```python
doc_events = {
    "Document": {
        "on_update": [
            "company_documents.nextcloud_sync.track_folder_changes",
            "company_documents.nextcloud_sync.track_file_deletions",
            "company_documents.nextcloud_sync.upload_to_nextcloud",
            "company_documents.nextcloud_sync.delete_from_nextcloud"
        ]
    }
}
```

#### 3.1.2 Document File (Child Table)

**–¢–∏–ø:** Child Table  
**–†–æ–¥–∏—Ç–µ–ª—å:** Document  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `file` | Attach | –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª |
| `file_name` | Data | –ò–º—è —Ñ–∞–π–ª–∞ |
| `file_url` | Data | URL –≤ NextCloud (—Å file_id) |
| `file_synced` | Check | –§–ª–∞–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (v0.0.2.4+) |
| `uploaded_by` | Link (User) | –ö—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª (v0.0.2.4+) |
| `uploaded_on` | Datetime | –ö–æ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω (v0.0.2.4+) |

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –í v0.0.2.3 –∏ —Ä–∞–Ω–µ–µ –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–ª–æ—Å—å `is_synced` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ v0.0.2.4!

#### 3.1.3 Folder Structure Template

**–¢–∏–ø:** Document  
**–ú–æ–¥—É–ª—å:** Documents  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –®–∞–±–ª–æ–Ω—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫  
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Frappe NestedSet (–∏–µ—Ä–∞—Ä—Ö–∏—è)

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `name` | Data | ID —à–∞–±–ª–æ–Ω–∞: `FST-0001` |
| `folder_name` | Data | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ |
| `parent_folder_structure_template` | Link (Self) | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –ø–∞–ø–∫–∞ |
| `is_group` | Check | –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –≥—Ä—É–ø–ø–æ–π |
| `lft`, `rgt` | Int | NestedSet –∏–Ω–¥–µ–∫—Å—ã |

**–ö–†–ò–¢–ò–ß–ù–û - –ü–æ—Ä—è–¥–æ–∫ –≤ fixtures:**
```json
[
  {"name": "FST-0001", "parent_folder_structure_template": null},  // –°–ù–ê–ß–ê–õ–ê —Ä–æ–¥–∏—Ç–µ–ª–∏
  {"name": "FST-0004", "parent_folder_structure_template": "FST-0001"},  // –ü–û–¢–û–ú –¥–µ—Ç–∏
  // ...
]
```

**–ü—Ä–æ–±–ª–µ–º–∞ v0.0.2.2:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ ‚Üí `TypeError: cannot unpack non-iterable NoneType object`  
**–†–µ—à–µ–Ω–∏–µ v0.0.2.3:** –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã JSON, –¥–æ–±–∞–≤–ª–µ–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

#### 3.1.4 NextCloud Sync Settings

**–¢–∏–ø:** Single DocType  
**–ú–æ–¥—É–ª—å:** Documents  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ NextCloud

**‚ö†Ô∏è –í–ê–ñ–ù–û:** Single DocType —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `tabSingles`, –ù–ï –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ!

**–ü–æ–ª—è:**
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `enabled` | Check | –í–∫–ª—é—á–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é |
| `nc_url` | Data | URL NextCloud |
| `nc_username` | Data | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `nc_password` | Password | –ü–∞—Ä–æ–ª—å (AES-256 –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω) |
| `nc_root_path` | Data | –ö–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

**–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è:**
```python
from frappe.utils.password import get_decrypted_password

nc_password = get_decrypted_password(
    "NextCloud Sync Settings",  # DocType
    "NextCloud Sync Settings",  # Name (–¥–ª—è Single = DocType)
    "nc_password",              # Fieldname
    raise_exception=False
)
```

### 3.2 Server Scripts (5 —Å–∫—Ä–∏–ø—Ç–æ–≤)

**–í–∫–ª—é—á–µ–Ω–∏–µ –≤ Frappe v15:**
```bash
bench set-config -g server_script_enabled 1  # -g –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
```

**–¢–∏–ø—ã:**
- API scripts
- DocType events
- Scheduled jobs
- Permission scripts
- Button actions

### 3.3 Client Scripts (7 —Å–∫—Ä–∏–ø—Ç–æ–≤)

**–í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

**–°–æ–±—ã—Ç–∏—è:**
- Form lifecycle (refresh, validate, before_save)
- Field changes (onchange)
- Custom buttons
- List view events

---

## 4. Frappe Framework v15 - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 4.1 Breaking Changes –∏–∑ v14

#### 4.1.1 Server Scripts Configuration

**‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –≤ v15 (—Ä–∞–±–æ—Ç–∞–ª–æ –≤ v14):**
```bash
bench set-config server_script_enabled true
```

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è v15:**
```bash
bench set-config -g server_script_enabled 1
```

**–ü—Ä–∏—á–∏–Ω–∞:** `is_safe_exec_enabled()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¢–û–õ–¨–ö–û `common_site_config.json` (—Ñ–ª–∞–≥ `-g`)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** https://github.com/frappe/frappe/wiki/Migrating-to-Version-15

### 4.1.1.1 Task Document Link

**–¢–∏–ø:** Document  
**–ú–æ–¥—É–ª—å:** Projects  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤—è–∑—å –∑–∞–¥–∞—á —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `task` | Link (Task) | –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–¥–∞—á—É |
| `document` | Link (Document) | –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –°–≤—è–∑–∞—Ç—å Document —Å Task –∏–∑ ERPNext Projects

#### 4.1.2 –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–£–¥–∞–ª–µ–Ω—ã –∏–∑ Frappe v15:**
- googlemaps
- urllib3
- gitdb
- pypng
- schedule
- pycryptodome

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤ `requirements.txt` –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

#### 4.1.3 Database API –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–£–¥–∞–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:**
- `frappe.db.touch()`
- `frappe.db.clear_table()`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `as_utf8`, `formatted`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ:**
```python
frappe.db.set_value(doctype, name, field, value)
```

### 4.2 –í–∞–∂–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ Frappe

#### 4.2.1 Hooks —Å–∏—Å—Ç–µ–º–∞

**–§–∞–π–ª:** `company_documents/hooks.py`

**–¢–∏–ø—ã hooks:**

1. **Doc Events (—Å–æ–±—ã—Ç–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤):**
```python
doc_events = {
    "Document": {
        "before_insert": "path.to.function",
        "after_insert": "path.to.function",
        "before_save": "path.to.function",
        "on_update": "path.to.function",
        "on_submit": "path.to.function",
        "on_cancel": "path.to.function",
        "on_trash": "path.to.function",
    }
}
```

2. **Scheduler Events:**
```python
scheduler_events = {
    "daily": [
        "path.to.daily_task"
    ],
    "hourly": [
        "path.to.hourly_task"
    ]
}
```

3. **Web Request Hooks:**
```python
before_request = [
    "path.to.middleware"
]
```

#### 4.2.2 Fixtures —Å–∏—Å—Ç–µ–º–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è–º–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ hooks.py:**
```python
fixtures = [
    # –ü—Ä–æ—Å—Ç–æ–π —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
    {"dt": "Server Script"},
    
    # –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    {
        "dt": "DocType",
        "filters": [
            ["module", "=", "Documents"],
            ["custom", "=", 1]
        ]
    },
    
    # –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
    {
        "dt": "Custom Field",
        "filters": [["module", "=", "Documents"]],
        "fields": ["name", "label", "fieldtype"]  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    }
]
```

**–í–∞–∂–Ω–æ:** Fixtures –ù–ï —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ!

#### 4.2.3 NestedSet (–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

**–ß—Ç–æ —ç—Ç–æ:** –°–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –ë–î

**–ü–æ–ª—è:**
- `lft` (left) - –ª–µ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
- `rgt` (right) - –ø—Ä–∞–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
- `parent_<doctype>` - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è
- `is_group` - —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≥—Ä—É–ø–ø–æ–π (–∏–º–µ–µ—Ç –¥–µ—Ç–µ–π)

**–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è fixtures:**
```
–†–æ–¥–∏—Ç–µ–ª–∏ –î–û–õ–ñ–ù–´ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –ü–ï–†–ï–î –¥–µ—Ç—å–º–∏!
```

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞:**
```json
[
  {"name": "FST-0001", "parent": null, "lft": 1, "rgt": 10},       // Root
  {"name": "FST-0004", "parent": "FST-0001", "lft": 2, "rgt": 3},  // Child of FST-0001
  {"name": "FST-0015", "parent": "FST-0004", "lft": 4, "rgt": 5}   // Grandchild
]
```

**–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `scripts/validate_fst_order.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—è–¥–∫–∞
- `scripts/fix_fst_order.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## 5. Fixtures - –≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### 5.1 –ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ fixtures?

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (v0.0.2.4):**

| –¢–∏–ø | –§–∏–ª—å—Ç—Ä | –§–∞–π–ª | –†–∞–∑–º–µ—Ä |
|-----|--------|------|--------|
| DocType | module=Documents, custom=1 | doctype.json | ~87 KB |
| DocType | module=Projects, custom=1 | doctype.json | ~87 KB |
| Server Script | –≤—Å–µ | server_script.json | ~18 KB |
| Client Script | –≤—Å–µ | client_script.json | ~12 KB |
| Custom Field | module in [Documents, Projects] | custom_field.json | 2 –±–∞–π—Ç (–ø—É—Å—Ç–æ) |
| Property Setter | module in [Documents, Projects] | property_setter.json | 2 –±–∞–π—Ç (–ø—É—Å—Ç–æ) |
| Folder Structure Template | –≤—Å–µ | folder_structure_template.json | ~17 KB |
| Document Naming Rule | document_type=Document | document_naming_rule.json | 296 –±–∞–π—Ç |
| Workspace | title="Documents app" | workspace.json | ~2.5 KB |

### 5.2 –≠–∫—Å–ø–æ—Ä—Ç fixtures (–∏–∑ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)

#### 5.2.1 –ß–µ—Ä–µ–∑ bench –∫–æ–º–∞–Ω–¥—É

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose exec backend bash

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ fixtures –∏–∑ hooks.py
bench --site localhost export-fixtures

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –æ–±–Ω–æ–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã –≤ company_documents/fixtures/
```

#### 5.2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
# –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
ls -lh company_documents/fixtures/

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
jq 'length' company_documents/fixtures/folder_structure_template.json
# –í—ã–≤–æ–¥: 45

# –ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å
jq '.[0]' company_documents/fixtures/doctype.json
```

#### 5.2.3 –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –ø–æ–ª–µ: counter –≤ Document Naming Rule

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –§–∞–π–ª `document_naming_rule.json` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `counter` –∫–æ—Ç–æ—Ä–æ–µ —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–∏–π —Å—á—ë—Ç—á–∏–∫ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "doctype": "Document Naming Rule",
  "document_type": "Document",
  "counter": 45,  // ‚Üê –¢–ï–ö–£–©–ï–ï –ó–ù–ê–ß–ï–ù–ò–ï –ò–ó –†–ê–ó–†–ê–ë–û–¢–ö–ò!
  "prefix": "DOC-.YYYY.-",
  ...
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ `company_documents` —Å—á—ë—Ç—á–∏–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (45), –∞ –Ω–µ —Å 0.

**–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—á—ë—Ç—á–∏–∫ (–∏–µ—Ä–∞—Ä—Ö–∏—è):**
1. **Document Naming Rule.counter** (–ë–î) - –ì–õ–ê–í–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö –ü–†–ê–í–î–´
2. **tabSeries** (–ë–î) - –∫—ç—à –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
3. **Python memory cache** - –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫—ç—à –≤ runtime

**–í–ê–ñ–ù–û:** –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ `tabSeries` –∏–ª–∏ `tabDocument` –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫!

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–±—Ä–æ—Å–∞:**
```python
# –£–¥–∞–ª–∏—Ç—å Document Naming Rule —Ü–µ–ª–∏–∫–æ–º
frappe.delete_doc("Document Naming Rule", "rule_name", force=1)

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å counter=0
naming_rule = frappe.get_doc({
    "doctype": "Document Naming Rule",
    "document_type": "Document",
    "prefix": "DOC-.YYYY.-",
    "counter": 0,  # ‚Üê –°–ë–†–û–°!
    ...
})
naming_rule.insert()
frappe.db.commit()
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–º. `docs/internals/NAMING_MECHANISM.md` –∏ `docs/internals/FIXTURES_MECHANICS.md`

#### 5.2.4 –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ

**‚úÖ –î–ï–õ–ê–¢–¨:**
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è DocType –≤ UI
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤ folder_structure_template.json
- **–ü—Ä–æ–≤–µ—Ä—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `counter` –≤ document_naming_rule.json –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º**
- –ö–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2 –±–∞–π—Ç–∞)

**‚ùå –ù–ï –î–ï–õ–ê–¢–¨:**
- –ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å JSON –≤—Ä—É—á–Ω—É—é (–∫—Ä–æ–º–µ –ø–æ—Ä—è–¥–∫–∞ FST)
- –ù–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ fixtures
- –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã `custom=1` –¥–ª—è DocTypes —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∫–æ–¥

### 5.3 –ò–º–ø–æ—Ä—Ç fixtures (–Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ)

#### 5.3.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

```bash
bench new-site localhost \
  --install-app erpnext \
  --install-app hrms \
  --install-app raven \
  --install-app pibidav \
  --install-app company_documents  # fixtures –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

#### 5.3.2 –†—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç fixtures

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose exec backend bash

# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å fixtures
bench --site localhost import-app company_documents

# –ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
bench --site localhost import-doc company_documents/fixtures/doctype.json
```

#### 5.3.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ DocTypes —Å–æ–∑–¥–∞–Ω—ã
bench --site localhost console
>>> frappe.get_list("DocType", filters={"app": "company_documents"})

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Server Scripts
>>> frappe.get_list("Server Script")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Folder Structure Template
>>> frappe.get_list("Folder Structure Template")
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 45 –∑–∞–ø–∏—Å–µ–π
```

### 5.4 Fixtures vs Migrations

| –ê—Å–ø–µ–∫—Ç | Fixtures | Migrations (patches) |
|--------|----------|----------------------|
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (DocTypes, Scripts) | –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |
| **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** | v0.0.2 (–ü–û–õ–ò–ì–û–ù) | v1.0.0+ (Production) |
| **–§–æ—Ä–º–∞—Ç** | JSON —Ñ–∞–π–ª—ã | Python —Å–∫—Ä–∏–ø—Ç—ã |
| **–ò–º–ø–æ—Ä—Ç** | –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ü—Ä–∏ `bench migrate` |
| **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | –î–∞ (–º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ) | –ù–µ—Ç (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑) |
| **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** | –í Git | –í patches.txt + —Ñ–∞–π–ª—ã |

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç:** –ò—Å–ø–æ–ª—å–∑—É–µ–º –¢–û–õ–¨–ö–û fixtures, –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—É—Å—Ç—ã–µ (patches.txt = 6 –±–∞–π—Ç)

---

## 6. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 6.1 –§–∏–ª–æ—Å–æ—Ñ–∏—è –ü–û–õ–ò–ì–û–ù

**–ß—Ç–æ —Ç–∞–∫–æ–µ –ü–û–õ–ò–ì–û–ù?**
- –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ü–û–õ–ù–û–°–¢–¨–Æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
- –ú–æ–∂–Ω–æ —Å–ª–æ–º–∞—Ç—å - –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å - –±—ã—Å—Ç—Ä–æ (Docker)
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ù–ï –Ω—É–∂–Ω—ã - –≤—Å–µ–≥–¥–∞ —á–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

**–ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å:**
- ‚úÖ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è fixtures
- ‚úÖ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è DocTypes
- ‚úÖ –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ö–æ–≥–¥–∞ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å

### 6.2 Docker Workflow

#### 6.2.1 –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã + volumes
docker compose down -v

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è apps.json)
export APPS_JSON_BASE64=$(base64 -w 0 apps.json)
docker build \
  --build-arg APPS_JSON_BASE64="$APPS_JSON_BASE64" \
  --tag custom-erpnext:v15-0.0.2.4 \
  --file images/custom/Containerfile \
  .

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker compose up -d

# 4. –°–ª–µ–¥–∏—Ç—å –∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π
docker compose logs -f create-site

# –û–∂–∏–¥–∞–Ω–∏–µ: ~10-15 –º–∏–Ω—É—Ç –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
```

#### 6.2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å Running:
# - backend (Frappe)
# - frontend (Nginx)
# - db (MariaDB)
# - redis-cache
# - redis-queue
# - scheduler
# - worker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs backend | grep "Serving"
# –í—ã–≤–æ–¥: Serving on http://0.0.0.0:8000

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl http://localhost:8000/api/method/ping
# –í—ã–≤–æ–¥: {"message":"pong"}
```

#### 6.2.3 –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–∞–π—Ç–∞ (–ë–ï–ó –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞):**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker compose stop

# –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ volumes —Å–∞–π—Ç–∞
docker volume rm frappe_docker_sites

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d
docker compose logs -f create-site
```

### 6.3 –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ UI (Desk)

#### 6.3.1 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ DocType —á–µ—Ä–µ–∑ UI

**–®–∞–≥–∏:**

1. **–û—Ç–∫—Ä—ã—Ç—å Desk:**
   ```
   http://localhost:8000/app/doctype
   ```

2. **New DocType:**
   - Name: `My Custom DocType`
   - Module: `Documents`
   - ‚úÖ Is Submittable (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω workflow)
   - ‚úÖ Track Changes (–¥–ª—è –∞—É–¥–∏—Ç–∞)

3. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è:**
   - Label: `Customer Name`
   - Type: `Link`
   - Options: `Customer`
   - Reqd: ‚úÖ

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:**
   - Save
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å permissions –¥–ª—è —Ä–æ–ª–µ–π

5. **–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ fixtures:**
   ```bash
   docker compose exec backend bash
   bench --site localhost export-fixtures
   ```

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git diff company_documents/fixtures/doctype.json
   ```

7. **–ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å:**
   ```bash
   git add company_documents/fixtures/doctype.json
   git commit -m "feat: Add My Custom DocType"
   ```

#### 6.3.2 –°–æ–∑–¥–∞–Ω–∏–µ Server Script —á–µ—Ä–µ–∑ UI

**–®–∞–≥–∏:**

1. **–û—Ç–∫—Ä—ã—Ç—å Server Script:**
   ```
   http://localhost:8000/app/server-script
   ```

2. **New Server Script:**
   - Script Name: `Validate Document`
   - Script Type: `DocType Event`
   - Reference DocType: `Document`
   - Event: `Before Save`

3. **–ö–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞:**
   ```python
   def before_save(doc, method):
       if not doc.project:
           frappe.throw("Project is mandatory!")
   ```

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   - Save
   - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å Document –±–µ–∑ Project
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞

5. **–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   ```bash
   bench --site localhost export-fixtures
   ```

#### 6.3.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Console

```bash
# –í–æ–π—Ç–∏ –≤ Python console
docker compose exec backend bash
bench --site localhost console

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
>>> doc = frappe.new_doc("Document")
>>> doc.project = "TEST"
>>> doc.level_1 = "FST-0001"
>>> doc.insert()

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
>>> print(doc.name)
DOC-2025-00001

# –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª
>>> file_doc = frappe.get_doc({
...     "doctype": "File",
...     "file_name": "test.pdf",
...     "attached_to_doctype": "Document",
...     "attached_to_name": doc.name
... })
>>> file_doc.insert()

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
>>> doc.reload()
>>> doc.files[0].file_synced
1  # –§–∞–π–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ NextCloud!
```

### 6.4 –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å (bench)

#### 6.4.1 –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose exec backend bash

# === –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===

# –í–µ—Ä—Å–∏—è Frappe
bench version

# –°–ø–∏—Å–æ–∫ —Å–∞–π—Ç–æ–≤
bench --site localhost list-apps

# –°–ø–∏—Å–æ–∫ DocTypes
bench --site localhost console
>>> frappe.get_list("DocType", {"app": "company_documents"})

# === –ë–ê–ó–ê –î–ê–ù–ù–´–• ===

# MariaDB –∫–æ–Ω—Å–æ–ª—å
bench --site localhost mariadb

# SQL –∑–∞–ø—Ä–æ—Å
bench --site localhost mariadb -e "SELECT name FROM tabDocument LIMIT 5;"

# === –ö–≠–® –ò –û–ß–ï–†–ï–î–ò ===

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
bench --site localhost clear-cache

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å workers
docker compose restart worker scheduler

# === –õ–û–ì–ò ===

# –õ–æ–≥–∏ Frappe
docker compose logs backend

# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
docker compose exec backend tail -f sites/localhost/logs/error.log

# === –†–ê–ó–†–ê–ë–û–¢–ö–ê ===

# –í–∫–ª—é—á–∏—Ç—å dev mode
bench --site localhost set-config developer_mode 1

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å assets
bench --site localhost build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Frappe
docker compose restart backend
```

#### 6.4.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ NextCloud —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```bash
# –í–æ–π—Ç–∏ –≤ console
bench --site localhost console

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
>>> from company_documents.nextcloud_sync import get_nextcloud_config
>>> config = get_nextcloud_config()
>>> print(config)
{'url': 'https://cloud.example.com', 'user': 'admin', ...}

# –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏
>>> from company_documents.nextcloud_sync import create_nextcloud_folder
>>> result = create_nextcloud_folder('test_folder', config)
>>> print(result)
True  # –ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å file_id —Ñ—É–Ω–∫—Ü–∏—é
>>> from company_documents.nextcloud_sync import get_nextcloud_file_id
>>> file_id = get_nextcloud_file_id('Projects/TEST/file.pdf', config)
>>> print(file_id)
'123456'  # file_id –ø–æ–ª—É—á–µ–Ω!

# –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
>>> from company_documents.nextcloud_sync import sync_document_to_nextcloud
>>> result = sync_document_to_nextcloud("DOC-2025-00001")
>>> print(result)
{'success': True, 'uploaded': 3}
```

---

## 7. NextCloud –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 7.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `company_documents/nextcloud_sync.py` (636 —Å—Ç—Ä–æ–∫)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

1. **`get_nextcloud_config()`** - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
2. **`get_nextcloud_file_id(file_path, config)`** - NEW v0.0.2.4! –ü–æ–ª—É—á–µ–Ω–∏–µ file_id —á–µ—Ä–µ–∑ PROPFIND
3. **`create_nextcloud_folder(path, config)`** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ (MKCOL)
4. **`get_folder_path(doc)`** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É—Ç–∏: `Projects/ProjectName/Level1/.../Level5`
5. **`upload_to_nextcloud(doc, method)`** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (PUT)
6. **`move_files_in_nextcloud(doc, old_path)`** - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (MOVE)
7. **`delete_from_nextcloud(doc, method)`** - —É–¥–∞–ª–µ–Ω–∏–µ (DELETE)

### 7.2 WebDAV –æ–ø–µ—Ä–∞—Ü–∏–∏

#### 7.2.1 MKCOL - –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏

```python
import requests
from requests.auth import HTTPBasicAuth
from urllib.parse import quote

def create_nextcloud_folder(path, config):
    safe_path = quote(path.encode('utf-8'))
    url = f"{config['url']}/remote.php/dav/files/{config['user']}/{safe_path}"
    
    response = requests.request(
        'MKCOL',
        url,
        auth=HTTPBasicAuth(config['user'], config['password']),
        timeout=30
    )
    
    return response.status_code in [201, 405]  # 405 = —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

#### 7.2.2 PUT - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞

```python
def upload_file_to_nextcloud(local_path, remote_path, config):
    safe_path = quote(remote_path.encode('utf-8'))
    url = f"{config['url']}/remote.php/dav/files/{config['user']}/{safe_path}"
    
    with open(local_path, 'rb') as f:
        response = requests.put(
            url,
            data=f,
            auth=HTTPBasicAuth(config['user'], config['password']),
            timeout=120
        )
    
    return response.status_code in [200, 201, 204]
```

#### 7.2.3 PROPFIND - –ü–æ–ª—É—á–µ–Ω–∏–µ file_id (NEW v0.0.2.4)

```python
import xml.etree.ElementTree as ET

def get_nextcloud_file_id(file_path, config):
    safe_path = quote(file_path.encode('utf-8'))
    url = f"{config['url']}/remote.php/dav/files/{config['user']}/{safe_path}"
    
    propfind_xml = '''<?xml version="1.0"?>
<d:propfind xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns" xmlns:nc="http://nextcloud.org/ns">
  <d:prop>
    <oc:fileid/>
    <nc:fileid/>
  </d:prop>
</d:propfind>'''
    
    response = requests.request(
        'PROPFIND',
        url,
        data=propfind_xml,
        headers={'Depth': '0'},
        auth=HTTPBasicAuth(config['user'], config['password']),
        timeout=10
    )
    
    if response.status_code == 207:
        root = ET.fromstring(response.content)
        
        # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å oc:fileid (OwnCloud)
        ns_oc = {'d': 'DAV:', 'oc': 'http://owncloud.org/ns'}
        fileid_elem = root.find('.//oc:fileid', ns_oc)
        if fileid_elem is not None:
            return fileid_elem.text
        
        # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å nc:fileid (NextCloud 25+)
        ns_nc = {'d': 'DAV:', 'nc': 'http://nextcloud.org/ns'}
        fileid_elem = root.find('.//nc:fileid', ns_nc)
        if fileid_elem is not None:
            return fileid_elem.text
    
    return None
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ file_id –¥–ª—è —Å—Å—ã–ª–æ–∫:**
```python
if file_id:
    # –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –§–ê–ô–õ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É)
    file_url = f"{config['url']}/apps/files/files/{file_id}?dir=/{quote(folder_path)}&openfile=true"
else:
    # Fallback: —Å—Å—ã–ª–∫–∞ –Ω–∞ –ü–ê–ü–ö–£
    file_url = f"{config['url']}/apps/files/?dir={quote(folder_path)}"
```

#### 7.2.4 MOVE - –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

```python
def move_file_in_nextcloud(old_path, new_path, config):
    old_safe = quote(old_path.encode('utf-8'))
    new_safe = quote(new_path.encode('utf-8'))
    
    source_url = f"{config['url']}/remote.php/dav/files/{config['user']}/{old_safe}"
    dest_url = f"{config['url']}/remote.php/dav/files/{config['user']}/{new_safe}"
    
    response = requests.request(
        'MOVE',
        source_url,
        headers={'Destination': dest_url},
        auth=HTTPBasicAuth(config['user'], config['password']),
        timeout=30
    )
    
    return response.status_code in [201, 204]
```

#### 7.2.5 DELETE - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

```python
def delete_file_from_nextcloud(path, config):
    safe_path = quote(path.encode('utf-8'))
    url = f"{config['url']}/remote.php/dav/files/{config['user']}/{safe_path}"
    
    response = requests.delete(
        url,
        auth=HTTPBasicAuth(config['user'], config['password']),
        timeout=10
    )
    
    return response.status_code in [204, 404]  # 404 = —É–∂–µ —É–¥–∞–ª–µ–Ω
```

### 7.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—É—Ç–µ–π –≤ NextCloud

```
NextCloud/
‚îî‚îÄ‚îÄ remote.php/dav/files/USERNAME/
    ‚îî‚îÄ‚îÄ [ROOT_PATH]/                    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        ‚îî‚îÄ‚îÄ Projects/                   # –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
            ‚îî‚îÄ‚îÄ ProjectName/            # –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
                ‚îî‚îÄ‚îÄ Level1/             # level_1 –∏–∑ Document
                    ‚îî‚îÄ‚îÄ Level2/         # level_2
                        ‚îî‚îÄ‚îÄ Level3/     # level_3
                            ‚îî‚îÄ‚îÄ Level4/ # level_4
                                ‚îî‚îÄ‚îÄ Level5/  # level_5
                                    ‚îî‚îÄ‚îÄ file.pdf  # –§–∞–π–ª
```

**–ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ URL:**
```
https://cloud.example.com/remote.php/dav/files/admin/Projects/TEST/Progettazione/Preliminare/file.pdf
```

**–° root_path:**
```
https://cloud.example.com/remote.php/dav/files/admin/company_docs/Projects/TEST/.../file.pdf
```

### 7.4 Hooks —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**

1. **`track_folder_changes(doc, method)`** - Before Save
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π `get_folder_path()`
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `doc._folder_changed = True`

2. **`track_file_deletions(doc, method)`** - Before Save
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π —Å–ø–∏—Å–∫–∏ —Ñ–∞–π–ª–æ–≤
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —É–¥–∞–ª–µ–Ω–Ω—ã–µ –≤ `doc._deleted_files`

3. **`upload_to_nextcloud(doc, method)`** - After Save (on_update)
   - –°–æ–∑–¥–∞–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é –ø–∞–ø–æ–∫ –≤ NextCloud
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã (`file_synced = 0`)
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `file_url` –¥–ª—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (v0.0.2.4+)
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `file_synced = 1`, `uploaded_by`, `uploaded_on`

4. **`move_files_in_nextcloud(doc, old_path)`** - After Save
   - –ï—Å–ª–∏ `doc._folder_changed == True`
   - –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ —Å—Ç–∞—Ä–æ–π –ø–∞–ø–∫–∏ –≤ –Ω–æ–≤—É—é (MOVE)
   - –£–¥–∞–ª—è–µ—Ç –ø—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏

5. **`delete_from_nextcloud(doc, method)`** - After Save
   - –ï—Å–ª–∏ `doc._deleted_files` –Ω–µ –ø—É—Å—Ç–æ
   - –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ NextCloud (DELETE)
   - –£–¥–∞–ª—è–µ—Ç –ø—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏

---

## 8. –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 8.1 Fixtures –∏–º–ø–æ—Ä—Ç

#### –ü—Ä–æ–±–ª–µ–º–∞: TypeError –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ FST

**–û—à–∏–±–∫–∞:**
```
TypeError: cannot unpack non-iterable NoneType object
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤ `folder_structure_template.json` - –¥–µ—Ç–∏ –∏–¥—É—Ç –ø–µ—Ä–µ–¥ —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
python scripts/validate_fst_order.py

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
python scripts/fix_fst_order.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git diff company_documents/fixtures/folder_structure_template.json

# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git add company_documents/fixtures/folder_structure_template.json
git commit -m "fix: Correct FST order"
```

#### –ü—Ä–æ–±–ª–µ–º–∞: Empty fixtures (2 bytes)

**–°–∏–º–ø—Ç–æ–º:** –§–∞–π–ª—ã `custom_field.json`, `property_setter.json` —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ `[]` (2 –±–∞–π—Ç–∞)

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!)

**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è - –æ–Ω–∏ –±—É–¥—É—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã.

#### –ü—Ä–æ–±–ª–µ–º–∞: DocTypes –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º:** `doctype.json` –æ—Å—Ç–∞–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–º –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ UI

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –≤ fixtures

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
{
    "dt": "DocType",
    "filters": [
        ["module", "=", "Documents"],
        ["custom", "=", 1]  # ‚ùå DocTypes —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∫–æ–¥ –∏–º–µ—é—Ç custom=0!
    ]
}
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
{
    "dt": "DocType",
    "filters": [
        ["module", "=", "Documents"]
        # –ë–ï–ó custom=1!
    ]
}
```

### 8.2 NextCloud —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞: Files –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ NextCloud:**
```bash
bench --site localhost console
>>> settings = frappe.get_single("NextCloud Sync Settings")
>>> print(settings.enabled, settings.nc_url, settings.nc_username)
```

2. **–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```bash
>>> from company_documents.nextcloud_sync import test_nextcloud_connection
>>> result = test_nextcloud_connection()
>>> print(result)
{'success': True, 'message': '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! ‚úì'}
```

3. **–õ–æ–≥–∏ –æ—à–∏–±–æ–∫:**
```bash
docker compose exec backend tail -f sites/localhost/logs/error.log
```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ file_synced –ø–æ–ª—è:**
```python
>>> doc = frappe.get_doc("Document", "DOC-2025-00001")
>>> print(doc.files[0].file_synced)  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 –∏–ª–∏ 1
```

#### –ü—Ä–æ–±–ª–µ–º–∞: file_url —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–∞–ø–∫—É, –∞ –Ω–µ —Ñ–∞–π–ª

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ v0.0.2.3 —Å—Å—ã–ª–∫–∏ –≤–µ–ª–∏ –Ω–∞ –ø–∞–ø–∫—É, –Ω—É–∂–Ω—ã –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å—Å—è –¥–æ v0.0.2.4

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
>>> doc = frappe.get_doc("Document", "DOC-2025-00001")
>>> print(doc.files[0].file_url)
# v0.0.2.3: https://cloud.example.com/apps/files/?dir=/Projects/TEST
# v0.0.2.4: https://cloud.example.com/apps/files/files/123456?dir=/Projects/TEST&openfile=true
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (v0.0.2.4):**
1. –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ PUT
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `get_nextcloud_file_id()` —á–µ—Ä–µ–∑ PROPFIND
3. –ï—Å–ª–∏ file_id –ø–æ–ª—É—á–µ–Ω ‚Üí –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ —Å `openfile=true`
4. –ï—Å–ª–∏ file_id –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –Ω–∞ –ø–∞–ø–∫—É

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ is_synced vs file_synced

**–ò—Å—Ç–æ—Ä–∏—è:**
- v0.0.2.1 - v0.0.2.3: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –ø–æ–ª–µ `is_synced`
- v0.0.2.4: –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `file_synced` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)

**–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** (–ü–û–õ–ò–ì–û–ù - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å –Ω—É–ª—è)

### 8.3 Docker –ø—Ä–æ–±–ª–µ–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞: Container –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose logs backend

# –õ–æ–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∞–π—Ç–∞
docker compose logs create-site
```

**–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ (–Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 4GB RAM)
2. –ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã (8000, 3306, 6379)
3. –û—à–∏–±–∫–∞ –≤ apps.json

#### –ü—Ä–æ–±–ª–µ–º–∞: –°–∞–π—Ç –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–õ–æ–≥–∏:**
```bash
docker compose logs create-site | grep -i error
```

**–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:**

1. **MariaDB –Ω–µ –≥–æ—Ç–æ–≤:**
```
Error: Can't connect to MySQL server
```
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–æ–∂–¥–∞—Ç—å 30 —Å–µ–∫—É–Ω–¥ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker compose restart create-site
```

2. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:**
```
App company_documents not found
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –≤–µ—Ç–∫–∞ main —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

3. **–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ fixtures:**
```
TypeError: cannot unpack non-iterable NoneType object
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ FST (—Å–º. —Ä–∞–∑–¥–µ–ª 8.1)

---

## 9. Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 9.1 –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —á–µ—Ä–µ–∑ UI

**–ü—Ä–∏–º–µ—Ä:** –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ Document

1. **–û—Ç–∫—Ä—ã—Ç—å DocType:**
   ```
   http://localhost:8000/app/doctype/Document
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ:**
   - Label: `Customer`
   - Type: `Link`
   - Options: `Customer`
   - Insert After: `project`

3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å:** Save

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Document
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª–µ Customer –ø–æ—è–≤–∏–ª–æ—Å—å

5. **–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   ```bash
   docker compose exec backend bash
   bench --site localhost export-fixtures
   ```

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git diff company_documents/fixtures/doctype.json
   ```

7. **Commit:**
   ```bash
   git add company_documents/fixtures/doctype.json
   git commit -m "feat: Add customer field to Document"
   git push origin main
   ```

8. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏):**
   ```bash
   docker compose down -v
   docker compose up -d
   ```

### 9.2 –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–¥

**–ü—Ä–∏–º–µ—Ä:** –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ nextcloud_sync.py

1. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥:**
   ```python
   # company_documents/nextcloud_sync.py
   
   def my_new_function(doc):
       """New function description"""
       # Implementation
       pass
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å hook:**
   ```python
   # company_documents/hooks.py
   
   doc_events = {
       "Document": {
           "on_update": [
               # ... existing hooks
               "company_documents.nextcloud_sync.my_new_function"
           ]
       }
   }
   ```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:**
   ```bash
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Frappe
   docker compose restart backend
   
   # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ console
   docker compose exec backend bench --site localhost console
   >>> doc = frappe.get_doc("Document", "DOC-2025-00001")
   >>> doc.save()  # –î–æ–ª–∂–Ω–∞ –≤—ã–∑–≤–∞—Ç—å—Å—è –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
   ```

4. **–û–±–Ω–æ–≤–∏—Ç—å CHANGELOG:**
   ```markdown
   ## [0.0.2.5] - 2025-11-23
   
   ### Added
   - New function `my_new_function()` in nextcloud_sync.py
   ```

5. **–û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é:**
   ```python
   # company_documents/__init__.py
   __version__ = "0.0.2.5"
   
   # company_documents/hooks.py
   app_version = "0.0.2.5"
   ```

6. **Commit:**
   ```bash
   git add .
   git commit -m "feat: Add my_new_function to nextcloud_sync"
   git push origin main
   ```

### 9.3 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞

**–ü—Ä–∏–º–µ—Ä:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –≤ get_folder_path()

1. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –±–∞–≥:**
   ```bash
   docker compose exec backend bench --site localhost console
   >>> from company_documents.nextcloud_sync import get_folder_path
   >>> doc = frappe.get_doc("Document", "DOC-2025-00001")
   >>> path = get_folder_path(doc)
   >>> print(path)  # –û—à–∏–±–∫–∞!
   ```

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥:**
   ```python
   # company_documents/nextcloud_sync.py
   
   def get_folder_path(doc):
       if not doc.project:
           return None  # FIX: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
       # ...
   ```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   ```bash
   docker compose restart backend
   docker compose exec backend bench --site localhost console
   >>> # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
   ```

4. **–û–±–Ω–æ–≤–∏—Ç—å CHANGELOG:**
   ```markdown
   ## [0.0.2.5] - 2025-11-23
   
   ### Fixed
   - Fixed NoneType error in get_folder_path() when project is empty
   ```

5. **Commit:**
   ```bash
   git add company_documents/nextcloud_sync.py CHANGELOG.md
   git commit -m "fix: Handle empty project in get_folder_path()"
   git push origin main
   ```

---

## 10. –ß–µ–∫-–ª–∏—Å—Ç—ã –¥–ª—è AI

### 10.1 –ü–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å

- [ ] –£–∫–∞–∑–∞–Ω —É—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (CERTAIN/CONFIDENT/UNCERTAIN/DON'T KNOW)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≤–µ—Ä—Å–∏—è (Frappe v15, ERPNext v15.83.0)
- [ ] –£—á—Ç–µ–Ω—ã breaking changes v14‚Üív15
- [ ] –ù–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã —Ä–µ—à–µ–Ω–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –≤–µ—Ä—Å–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–µ—Å–ª–∏ CERTAIN)

### 10.2 –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ fixtures

- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∞–Ω—ã —á–µ—Ä–µ–∑ UI (–Ω–µ –≤—Ä—É—á–Ω—É—é –≤ JSON)
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω `bench --site localhost export-fixtures`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –≤ folder_structure_template.json
- [ ] –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω (–Ω–µ 2 –±–∞–π—Ç–∞ –≥–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ)
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –≤ Git
- [ ] –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (docker compose down -v && up)

### 10.3 –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å NestedSet (FST)

- [ ] –†–æ–¥–∏—Ç–µ–ª–∏ –∏–¥—É—Ç –ü–ï–†–ï–î –¥–µ—Ç—å–º–∏ –≤ JSON
- [ ] –ó–∞–ø—É—â–µ–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `scripts/validate_fst_order.py`
- [ ] –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –∑–∞–ø—É—â–µ–Ω `scripts/fix_fst_order.py`
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤ Git diff
- [ ] –¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞ —á–∏—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ

### 10.4 –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞

- [ ] –ö–æ–¥ —Å–ª–µ–¥—É–µ—Ç —Å—Ç–∏–ª—é –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã docstrings
- [ ] –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è (try/except)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ (`frappe.log_error()`)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω CHANGELOG.md
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤–µ—Ä—Å–∏–∏ (__init__.py –∏ hooks.py)
- [ ] –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤ console
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 10.5 –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å NextCloud

- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ NextCloud –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ UI
- [ ] –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω (`test_nextcloud_connection()`)
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ `file_synced` (v0.0.2.4+)
- [ ] file_url –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å file_id (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
- [ ] –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –æ—à–∏–±–∫–∏ WebDAV (timeouts, 404, 403)
- [ ] root_path —É—á—Ç–µ–Ω –≤ –ø—É—Ç—è—Ö

### 10.6 –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Docker

- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã (`docker compose ps`)
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (`docker compose logs`)
- [ ] –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤ (4GB RAM, 20GB disk)
- [ ] –ü–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã (8000, 3306, 6379)
- [ ] –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω (down -v && up)

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### A. –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

**Frappe Framework:**
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://frappeframework.com/docs/v15
- GitHub: https://github.com/frappe/frappe/tree/version-15
- Migration Guide v14‚Üív15: https://github.com/frappe/frappe/wiki/Migrating-to-Version-15
- API Reference: https://frappeframework.com/docs/v15/api
- Forum: https://discuss.frappe.io/

**ERPNext:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.erpnext.com/
- GitHub: https://github.com/frappe/erpnext/tree/v15.83.0
- User Manual: https://docs.erpnext.com/docs/v15/user/manual/en

**NextCloud:**
- WebDAV API: https://docs.nextcloud.com/server/stable/developer_manual/client_apis/WebDAV/
- Files API: https://docs.nextcloud.com/server/latest/developer_manual/client_apis/WebDAV/files.html

**Docker:**
- frappe_docker: https://github.com/frappe/frappe_docker

### B. –ì–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤

| –¢–µ—Ä–º–∏–Ω | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ |
|--------|-------------|
| **Bench** | CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Frappe/ERPNext |
| **DocType** | –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ - –∞–Ω–∞–ª–æ–≥ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î + UI + –ª–æ–≥–∏–∫–∞ |
| **Single DocType** | DocType —Å –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å—å—é (settings) |
| **Child Table** | –í–ª–æ–∂–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º) |
| **Fixtures** | JSON —Ñ–∞–π–ª—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ |
| **NestedSet** | –°–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –ë–î |
| **Hook** | –¢–æ—á–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è - callback –Ω–∞ —Å–æ–±—ã—Ç–∏—è |
| **Server Script** | Python —Å–∫—Ä–∏–ø—Ç, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ |
| **Client Script** | JS —Å–∫—Ä–∏–ø—Ç, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ |
| **WebDAV** | –ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ HTTP |
| **–ü–û–õ–ò–ì–û–ù** | –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å |

### C. Changelog v0.0.2.x

**v0.0.2.4** (2025-11-22) - üéâ PRODUCTION READY!
- ‚úÖ **NextCloud file_id support**: –§—É–Ω–∫—Ü–∏—è `get_nextcloud_file_id()` —á–µ—Ä–µ–∑ WebDAV PROPFIND
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `oc:fileid` (OwnCloud) –∏ `nc:fileid` (NextCloud 25+)
  - –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã —Å `openfile=true` –≤–º–µ—Å—Ç–æ –ø–∞–ø–æ–∫
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—è**: `is_synced` ‚Üí `file_synced` –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**:
  - –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `file_url` –¥–ª—è —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  - –ü–æ–ª—è `uploaded_by` –∏ `uploaded_on` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  - –°—á—ë—Ç—á–∏–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–ß–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `company_documents/company_documents/`
- ‚úÖ **–£–¥–∞–ª–µ–Ω—ã legacy DocTypes**: Project Document Type, Task Employee, CILA Document Row, Task Workspace Row (–æ—Å—Ç–∞–≤–ª–µ–Ω–æ 5 –∏–∑ 9)
- ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏**:
  - –í—Å–µ 5 DocTypes —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - 45 Folder Structure Templates –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
  - Server/Client Scripts —Ä–∞–±–æ—Ç–∞—é—Ç
  - Workspace "Documents App" –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–≥—Ä—É–∑–∫–∞, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
  - –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –ø–∞–ø–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã –≤ NextCloud
  - –ì–∞–ª–æ—á–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
  - pibidav –Ω–µ —Ä—É–≥–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

**v0.0.2.3** (2025-11-22):
- –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤ `folder_structure_template.json`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –≤ `__init__.py` (–±—ã–ª–∞ 0.0.2.1)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ FST: `validate_fst_order.py`, `fix_fst_order.py`
- –î–æ–±–∞–≤–ª–µ–Ω Git pre-commit hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**v0.0.2.2** (–¥–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞):
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è fixtures –∏–º–ø–æ—Ä—Ç–∞

**v0.0.2.1** (–¥–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞):
- NextCloud file_id support (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é - –¥–æ–¥–µ–ª–∞–Ω –≤ v0.0.2.4)

**v0.0.2.0** (–¥–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞):
- –ü–µ—Ä–≤–∞—è —Ä–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –ø—Ä–æ–µ–∫—Ç–æ–º Company Documents App.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
1. ‚úÖ –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ–≤–µ—Ç–æ–º
3. ‚úÖ –°–ª–µ–¥–æ–≤–∞—Ç—å —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –ü–û–õ–ò–ì–û–ù
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fixtures –≤–º–µ—Å—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–π
5. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —á–∏—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
- –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å breaking changes
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π

**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
- GitHub: https://github.com/ruslankonovets-22/Company-Documents-App
- Issues: https://github.com/ruslankonovets-22/Company-Documents-App/issues

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2025-11-22*  
*–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: 1.0*  
*–î–ª—è –ø—Ä–æ–µ–∫—Ç–∞: Company Documents App v0.0.2.4*
