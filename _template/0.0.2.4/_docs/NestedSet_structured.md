# Frappe NestedSet –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞:** 2025-11-24  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** v0.0.2.4  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –≤ Frappe

---

## üéØ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å?
- NestedSet –≤ Frappe: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏ –∫–æ–º–∞–Ω–¥—ã
- –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ª—é–±—ã—Ö –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —Å—Å—ã–ª–∫–∏

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å?
### 1.1 –ü—Ä–æ–±–ª–µ–º–∞, —Å –∫–æ—Ç–æ—Ä–æ–π –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å
–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ 45 Folder Structure Templates –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:

```python
TypeError: cannot unpack non-iterable NoneType object
```
–ü—Ä–∏—á–∏–Ω–∞: –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –î–û —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ.

### 1.2 –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ Frappe?
Frappe –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω NestedSet (–í–ª–æ–∂–µ–Ω–Ω–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä. –≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –î–û —Å–æ–∑–¥–∞–Ω–∏—è –∏—Ö –ø–æ—Ç–æ–º–∫–æ–≤.

**–ö–†–ò–¢–ò–ß–ù–û:** –ü–æ—Ä—è–¥–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ "—Ö–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π" - —ç—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã NestedSet.

---

## 2. NestedSet –≤ Frappe: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
### 2.1 –ß—Ç–æ —Ç–∞–∫–æ–µ NestedSet?
NestedSet (Modified Preorder Tree Traversal) - —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Frappe:
- Frappe Framework –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É nestedset –∏–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è
- –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: https://github.com/frappe/frappe/blob/develop/frappe/utils/nestedset.py
- Wiki: https://github.com/frappe/frappe/wiki/Tree-Structure

### 2.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ NestedSet –∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:

```python
# –ü—Ä–∏–º–µ—Ä –∏–∑ Frappe Framework
{
    "name": "FST-0001",
    "parent_folder_structure_template": None,  # –†–æ–¥–∏—Ç–µ–ª—å (Link field)
    "is_group": 1,                             # –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –≥—Ä—É–ø–ø–æ–π (–∏–º–µ–µ—Ç –¥–µ—Ç–µ–π)
    "lft": 1,                                  # Left boundary
    "rgt": 100,                                # Right boundary
}
```
–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:
- lft (left) ‚Äî –ª–µ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ —É–∑–ª–∞
- rgt (right) ‚Äî –ø—Ä–∞–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ —É–∑–ª–∞
- parent_* ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
- is_group ‚Äî —Ñ–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è –ø–æ—Ç–æ–º–∫–æ–≤

### 2.3 –ö–∞–∫ Frappe –≤—ã—á–∏—Å–ª—è–µ—Ç lft/rgt?
–ò–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ Frappe (frappe/utils/nestedset.py):

```python
def rebuild_tree(doctype, parent_field):
    """
    Rebuild the tree by recalculating lft and rgt values
    """
    def _get_children(parent):
        return frappe.get_all(doctype, 
            filters={parent_field: parent},
            order_by="name")
    
    def _rebuild_tree_recursive(parent, left):
        right = left + 1
        children = _get_children(parent)
        
        for child in children:
            right = _rebuild_tree_recursive(child.name, right)
        
        # –û–±–Ω–æ–≤–∏—Ç—å lft/rgt –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞
        frappe.db.set_value(doctype, parent, {
            'lft': left,
            'rgt': right
        }, update_modified=False)
        
        return right + 1
    
    # –ù–∞—á–∞—Ç—å —Å –∫–æ—Ä–Ω–µ–≤—ã—Ö —É–∑–ª–æ–≤ (parent = None)
    _rebuild_tree_recursive(None, 1)
```
**–ö–†–ò–¢–ò–ß–ù–û:** Frappe –≤—ã—á–∏—Å–ª—è–µ—Ç lft/rgt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ!

### 2.4 –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø–æ—Ä—è–¥–∫–∞?

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –ø–æ—Ä—è–¥–æ–∫:
create("FST-0004", parent="FST-0001")  # FST-0001 –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!

# Frappe –ø—ã—Ç–∞–µ—Ç—Å—è:
parent_doc = frappe.get_doc("Folder Structure Template", "FST-0001")
# ‚Üí –ù–ï –ù–ê–ô–î–ï–ù–û!
# ‚Üí frappe.DoesNotExistError –∏–ª–∏ TypeError

# lft/rgt –ù–ï –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω—ã
# ‚Üí TypeError: cannot unpack non-iterable NoneType object
```

---

## 3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞
### 3.1 –ü—Ä–∏–Ω—Ü–∏–ø: Breadth-First (–ø–æ —É—Ä–æ–≤–Ω—è–º)
–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:
- –°–Ω–∞—á–∞–ª–∞ –í–°–ï –∫–æ—Ä–Ω–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (level 0, parent = None)
- –ó–∞—Ç–µ–º –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã level 1 (–¥–µ—Ç–∏ –∫–æ—Ä–Ω–µ–π)
- –ó–∞—Ç–µ–º –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã level 2 (–≤–Ω—É–∫–∏)
- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Level 0 (Roots):
  FST-0001 (parent=None)
  FST-0002 (parent=None)
  FST-0003 (parent=None)

Level 1 (Children of roots):
  FST-0004 (parent=FST-0001) ‚Üê FST-0001 –£–ñ–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ
  FST-0005 (parent=FST-0001)
  FST-0006 (parent=FST-0002) ‚Üê FST-0002 –£–ñ–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ

Level 2 (Grandchildren):
  FST-0007 (parent=FST-0004) ‚Üê FST-0004 –£–ñ–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ
```

### 3.2 –ú–µ—Ç–æ–¥ –∏–∑ Frappe Framework
–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–∏–∑ frappe/utils/nestedset.py):

```python
def validate_loop(doc):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å"""
    if not doc.get(doc.nsm_parent_field):
        return
    
    # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø—Ä–µ–¥–∫–æ–≤
    ancestors = []
    parent = doc.get(doc.nsm_parent_field)
    
    while parent:
        if parent == doc.name:
            frappe.throw(_("Cannot create circular reference"))
        
        parent_doc = frappe.get_doc(doc.doctype, parent)
        ancestors.append(parent)
        parent = parent_doc.get(doc.nsm_parent_field)
```
**–í—ã–≤–æ–¥:** Frappe –ù–ï –ü–û–ó–í–û–õ–Ø–ï–¢ —Å–æ–∑–¥–∞—Ç—å —É–∑–µ–ª, –µ—Å–ª–∏ –µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

### 3.3 –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä—è–¥–∫–∞
–ò–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Frappe Wiki (https://github.com/frappe/frappe/wiki/Tree-Structure):

> When importing tree data, ensure that parent nodes are created before their children. Use the lft field to determine the order of creation.

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º:**
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ JSON
- –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (parent ‚Üí children)
- –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (Topological Sort)
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

---

## 4. –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
### 4.1 –ü—Ä–∏–Ω—Ü–∏–ø: –û–±—Ä–∞—Ç–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–ª–∏—Å—Ç—å—è ‚Üí –∫–æ—Ä–Ω–∏)
**–ö–†–ò–¢–ò–ß–ù–û:** –£–¥–∞–ª–µ–Ω–∏–µ –≤ NestedSet –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ –û–ë–†–ê–¢–ù–û–ú –ø–æ—Ä—è–¥–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è!

**–ü–æ—á–µ–º—É?**

–ò–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ Frappe (frappe/utils/nestedset.py):

```python
def on_trash(doc, method=None):
    """Hook called before deleting a document"""
    if doc.is_group:
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        children = frappe.get_all(doc.doctype,
            filters={doc.nsm_parent_field: doc.name})
        
        if children:
            frappe.throw(_(f"Cannot delete {doc.name} as it has child nodes"))
```
**–í—ã–≤–æ–¥:** Frappe –ù–ï –ü–û–ó–í–û–õ–Ø–ï–¢ —É–¥–∞–ª–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è, –ø–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –µ–≥–æ –¥–µ—Ç–∏!

### 4.2 –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –û—Ç –ª–∏—Å—Ç—å–µ–≤ –∫ –∫–æ—Ä–Ω—è–º
# Level 3 (–ª–∏—Å—Ç—å—è)
delete("FST-0007")  # –ù–µ—Ç –¥–µ—Ç–µ–π

# Level 2
delete("FST-0004")  # –¢–µ–ø–µ—Ä—å FST-0007 —É–¥–∞–ª—ë–Ω ‚Üí –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å FST-0004

# Level 1
delete("FST-0001")  # –¢–µ–ø–µ—Ä—å FST-0004 —É–¥–∞–ª—ë–Ω ‚Üí –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å FST-0001
```

### 4.3 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
–ú–µ—Ç–æ–¥: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–µ rgt (right) –≤ –û–ë–†–ê–¢–ù–û–ú –ø–æ—Ä—è–¥–∫–µ!

–ò–∑ Frappe Wiki:
> The rgt field represents the rightmost boundary of the node. Nodes with higher rgt values are deeper in the tree.

**SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:**
```sql
SELECT name, parent_folder_structure_template, lft, rgt
FROM `tabFolder Structure Template`
ORDER BY rgt DESC  -- –û—Ç –ª–∏—Å—Ç—å–µ–≤ (–±–æ–ª—å—à–æ–π rgt) –∫ –∫–æ—Ä–Ω—è–º (–º–∞–ª—ã–π rgt)
```

**Python —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
def delete_all_in_correct_order(doctype):
    """
    –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ NestedSet –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
    –ò—Å—Ç–æ—á–Ω–∏–∫ –º–µ—Ç–æ–¥–∞: frappe/utils/nestedset.py
    """
    # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ rgt DESC
    records = frappe.db.sql(f"""
        SELECT name, lft, rgt
        FROM `tab{doctype}`
        ORDER BY rgt DESC
    """, as_dict=True)
    
    for record in records:
        frappe.delete_doc(doctype, record.name, 
            force=1, 
            ignore_permissions=True)
    
    frappe.db.commit()
```

---

## 5. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
### 5.1 –ú–µ—Ç–æ–¥ 1: bench execute (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
–ò—Å—Ç–æ—á–Ω–∏–∫: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Frappe CLI
- https://frappeframework.com/docs/v15/user/en/bench/reference/bench-cli#bench-execute

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ Frappe
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ frappe.*
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π commit —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Error Log

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥—ã:**
```bash
bench --site <site_name> execute <module>.<function>
```

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è:**
```bash
# 1. –°–æ–∑–¥–∞—Ç—å Python —Ñ–∞–π–ª —Å —Ñ—É–Ω–∫—Ü–∏–µ–π
# apps/company_documents/company_documents/scripts/create_fst.py

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ bench execute
bench --site localhost execute company_documents.scripts.create_fst.create_all_fst
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ?**
> bench execute runs the function in the same process as the web server, ensuring all Frappe context (site, user, db connection) is properly initialized.

### 5.2 –ú–µ—Ç–æ–¥ 2: bench console (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)
–ò—Å—Ç–æ—á–Ω–∏–∫: https://frappeframework.com/docs/v15/user/en/bench/reference/bench-cli#bench-console

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –û—Ç–ª–∞–¥–∫–∞
- –†–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- ‚ùå –°–ª–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ —Å–∫—Ä–∏–ø—Ç—ã

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
bench --site localhost console
```

–í –∫–æ–Ω—Å–æ–ª–∏:
```python
>>> import frappe
>>> frappe.init(site='localhost')
>>> frappe.connect()
# –í–∞—à –∫–æ–¥
```

### 5.3 –ú–µ—Ç–æ–¥ 3: Python —Å–∫—Ä–∏–ø—Ç —á–µ—Ä–µ–∑ docker exec
**–í–ê–ñ–ù–û:** –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bench console —á–µ—Ä–µ–∑ heredoc!

‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
```bash
docker exec backend bench --site localhost console << 'PYEOF'
# Python –∫–æ–¥
PYEOF
```
–ü—Ä–æ–±–ª–µ–º–∞: bench console –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –æ–±–æ–ª–æ—á–∫—É IPython, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è heredoc.

‚úÖ –†–ê–ë–û–¢–ê–ï–¢:
```bash
docker exec backend bench --site localhost execute module.function
```

### 5.4 –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π workflow
–î–ª—è –õ–Æ–ë–û–ô –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ Frappe:

```python
# apps/your_app/your_app/scripts/create_tree.py
import frappe

def create_all_nodes():
    """
    –°–æ–∑–¥–∞—Ç—å –≤—Å–µ —É–∑–ª—ã –¥–µ—Ä–µ–≤–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
    –ü—Ä–∏–º–µ–Ω–∏–º–æ –∫: Account, Item Group, Customer Group, Territory, etc.
    """
    frappe.init(site=frappe.local.site)
    frappe.connect()
    
    # –î–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (—Ä–æ–¥–∏—Ç–µ–ª–∏ –ü–ï–†–ï–î –¥–µ—Ç—å–º–∏)
    nodes = [
        # Level 0 (roots)
        {"name": "ROOT-1", "parent": None, "is_group": 1},
        {"name": "ROOT-2", "parent": None, "is_group": 1},
        # Level 1
        {"name": "CHILD-1", "parent": "ROOT-1", "is_group": 0},
        {"name": "CHILD-2", "parent": "ROOT-1", "is_group": 1},
        # Level 2
        {"name": "GRANDCHILD-1", "parent": "CHILD-2", "is_group": 0},
    ]
    
    for node_data in nodes:
        if not frappe.db.exists("Your DocType", node_data["name"]):
            doc = frappe.get_doc({
                "doctype": "Your DocType",
                **node_data
            })
            doc.insert(ignore_permissions=True)
            print(f"‚úÖ Created: {doc.name}")
    
    frappe.db.commit()
    print(f"\n‚úÖ Total created: {len(nodes)}")
```

**–ó–∞–ø—É—Å–∫:**
```bash
bench --site localhost execute your_app.scripts.create_tree.create_all_nodes
```

---

## 6. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏ –∫–æ–º–∞–Ω–¥—ã
### 6.1 –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –£–¥–∞–ª–µ–Ω–∏–µ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ
**–®–∞–≥ 1: –£–¥–∞–ª–µ–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**

```python
# apps/your_app/your_app/scripts/cleanup.py
import frappe

def delete_all_tree_nodes(doctype):
    """
    –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —É–∑–ª—ã –¥–µ—Ä–µ–≤–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ª–∏—Å—Ç—å—è ‚Üí –∫–æ—Ä–Ω–∏)
    Args:
        doctype: –ò–º—è DocType (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Folder Structure Template")
    """
    frappe.init(site=frappe.local.site)
    frappe.connect()
    # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ rgt DESC
    records = frappe.db.sql(f"""
        SELECT name, parent_{doctype.lower().replace(' ', '_')}, lft, rgt
        FROM `tab{doctype}`
        ORDER BY rgt DESC
    """, as_dict=True)
    print(f"Found {len(records)} records")
    deleted = 0
    for record in records:
        try:
            frappe.delete_doc(doctype, record.name, 
                force=1, 
                ignore_permissions=True,
                ignore_on_trash=True)
            deleted += 1
            if deleted % 10 == 0:
                print(f"Deleted: {deleted}/{len(records)}")
        except Exception as e:
            print(f"‚ùå Error deleting {record.name}: {str(e)}")
    frappe.db.commit()
    print(f"\n‚úÖ Deleted {deleted} records")
```

**–ó–∞–ø—É—Å–∫:**
```bash
bench --site localhost execute your_app.scripts.cleanup.delete_all_tree_nodes --args "['Folder Structure Template']"
```

**–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**
```bash
bench --site localhost execute your_app.scripts.create_tree.create_all_nodes
```

### 6.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—è–¥–∫–∞ –≤ fixtures
–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JSON:

```python
# scripts/validate_tree_order.py
import json
import sys

def validate_tree_order(json_file, parent_field):
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–æ–¥–∏—Ç–µ–ª–∏ –∏–¥—É—Ç –ü–ï–†–ï–î –¥–µ—Ç—å–º–∏ –≤ JSON
    Args:
        json_file: –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É
        parent_field: –ò–º—è –ø–æ–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "parent_folder_structure_template")
    """
```
