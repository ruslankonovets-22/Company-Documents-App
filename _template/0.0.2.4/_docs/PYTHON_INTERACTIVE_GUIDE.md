# –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º Python –≤ Frappe Framework

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-25  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Ç–∏–ø–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Bench Console –∏ Python —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –≤ Frappe

---

## üéØ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É –≤–∞–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
2. –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å Python –≤ Frappe: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
3. Bench Console: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
4. Bench Execute: –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –º–µ—Ç–æ–¥
5. –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è
6. –†–∞–±–æ—Ç–∞ —Å NestedSet —á–µ—Ä–µ–∑ Python
7. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —á–µ–∫-–ª–∏—Å—Ç—ã
8. –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
9. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —Å—Å—ã–ª–∫–∏

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É –≤–∞–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

### 1.1 –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Frappe
Frappe Framework —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã Python –∫–æ–¥–∞:
- **Site context** ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–∞–π—Ç—É
- **Database connection** ‚Äî –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î
- **User context** ‚Äî —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **Request context** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–µ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

**–ö–†–ò–¢–ò–ß–ù–û:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–∞–º —Ç–∏–ø–∞:
```
AttributeError: 'NoneType' object has no attribute 'site'
TypeError: cannot unpack non-iterable NoneType object
frappe.DoesNotExistError: Site not found
```

### 1.2 –¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞ —Ä–∞–±–æ—Ç—ã

| –ú–µ—Ç–æ–¥ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤ |
|-------|-------------------|------------------------------|----------------------|
| **bench console** | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç (IPython shell) |
| **bench execute** | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| **Python script** | Standalone —Å–∫—Ä–∏–ø—Ç—ã | ‚ùå –ù–µ—Ç (–Ω—É–∂–Ω–∞ —Ä—É—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è) | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ |

---

## 2. –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å Python –≤ Frappe: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

### 2.1 –ú–µ—Ç–æ–¥ 1: bench console (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** https://docs.frappe.io/framework/user/en/bench/frappe-commands

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é IPython –æ–±–æ–ª–æ—á–∫—É —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º Frappe –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º. –î–æ—Å—Ç—É–ø–Ω–∞ –æ–ø—Ü–∏—è `--autoreload` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ.

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
bench --site <site_name> console
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**
```python
# Frappe –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
import frappe
frappe.init(site='<site_name>')
frappe.connect()
frappe.local.lang = frappe.db.get_default("lang") or "en"
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- ‚úÖ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–∞–Ω–¥ (IPython)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è heredoc (–º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã)
- ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (CI/CD)
- ‚ùå –°–ª–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `docker exec` —Å heredoc

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å:
bench --site localhost console

# –° –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –∫–æ–¥–∞ (—É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
bench --site localhost console --autoreload

# –í –∫–æ–Ω—Å–æ–ª–∏:
>>> import frappe
>>> doc = frappe.get_doc("User", "Administrator")
>>> print(doc.email)
>>> frappe.db.commit()
```

**‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (—Ç–∏–ø–æ–≤–∞—è –æ—à–∏–±–∫–∞):**
```bash
# –û–®–ò–ë–ö–ê: heredoc –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å IPython
docker exec backend bench --site localhost console << 'PYEOF'
import frappe
doc = frappe.get_doc("User", "Administrator")
print(doc.email)
PYEOF
# ‚Üí IPython –Ω–µ –ø—Ä–∏–º–µ—Ç heredoc, –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–∏—Å–Ω–µ—Ç
```

---

### 2.2 –ú–µ—Ç–æ–¥ 2: bench execute (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** https://docs.frappe.io/framework/user/en/bench/frappe-commands (execute command)

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í—ã–ø–æ–ª–Ω—è–µ—Ç Python —Ñ—É–Ω–∫—Ü–∏—é –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Frappe. –≠—Ç–æ **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π** –º–µ—Ç–æ–¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ batch-–æ–ø–µ—Ä–∞—Ü–∏–π.

**–í–∞–∂–Ω–æ:** –ö–æ–º–∞–Ω–¥–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ `execute`, –∞ –Ω–µ `bench execute` –≤ —Å–ø–∏—Å–∫–µ –∫–æ–º–∞–Ω–¥ Frappe.

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
bench --site <site_name> execute <module>.<function> --args '<json_args>'
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**
> bench execute runs the function in the same process as the web server, ensuring all Frappe context (site, user, db connection) is properly initialized.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
apps/
‚îî‚îÄ‚îÄ your_app/
    ‚îî‚îÄ‚îÄ your_app/
        ‚îî‚îÄ‚îÄ scripts/
            ‚îî‚îÄ‚îÄ my_script.py  # <-- –í–∞—à –º–æ–¥—É–ª—å
```

**–í–ê–ñ–ù–û:** –§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è (–Ω–µ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏).

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `my_script.py`:**
```python
import frappe

def create_users(names):
    """
    –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–º–µ–Ω
    Args:
        names: list - –°–ø–∏—Å–æ–∫ –∏–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    """
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω bench execute
    # frappe.init() –∏ frappe.connect() –ù–ï –ù–£–ñ–ù–´!
    
    for name in names:
        if not frappe.db.exists("User", name):
            doc = frappe.get_doc({
                "doctype": "User",
                "email": name,
                "first_name": name.split("@")[0]
            })
            doc.insert(ignore_permissions=True)
            print(f"‚úÖ Created: {doc.name}")
    
    frappe.db.commit()
    print(f"\n‚úÖ Total created: {len(names)}")
```

**–ó–∞–ø—É—Å–∫:**
```bash
# –ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:
bench --site localhost execute your_app.scripts.my_script.create_users

# –° –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ (JSON):
bench --site localhost execute your_app.scripts.my_script.create_users \
  --args '["user1@example.com", "user2@example.com"]'
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (CI/CD)
- ‚úÖ –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Error Log
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `docker exec`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (JSON)
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–Ω–µ inline –∫–æ–¥)
- ‚ö†Ô∏è –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ JSON

---

### 2.3 –ú–µ—Ç–æ–¥ 3: Standalone Python —Å–∫—Ä–∏–ø—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ó–∞–ø—É—Å–∫ Python —Å–∫—Ä–∏–ø—Ç–∞ –≤–Ω–µ Frappe CLI. –¢—Ä–µ–±—É–µ—Ç **—Ä—É—á–Ω–æ–π** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

**‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ç–∏–ø–æ–≤–∞—è –æ—à–∏–±–∫–∞):**
```python
# script.py
import frappe

# –û–®–ò–ë–ö–ê: –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!
doc = frappe.get_doc("User", "Administrator")
# ‚Üí AttributeError: 'NoneType' object has no attribute 'site'
```

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:**
```python
# script.py
import frappe

def main():
    # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å site
    frappe.init(site='localhost')
    
    # 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
    frappe.connect()
    
    # 3. –í–∞—à –∫–æ–¥
    doc = frappe.get_doc("User", "Administrator")
    print(doc.email)
    
    # 4. Commit —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    frappe.db.commit()
    
    # 5. –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    frappe.destroy()

if __name__ == "__main__":
    main()
```

**–ó–∞–ø—É—Å–∫:**
```bash
# –ß–µ—Ä–µ–∑ bench (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
bench --site localhost run python script.py

# –ù–∞–ø—Ä—è–º—É—é (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
cd frappe-bench
source env/bin/activate
python script.py
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ –∑–∞–±—ã—Ç—å)
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ª–æ–≥–æ–≤ –≤ Error Log
- ‚ùå –õ–µ–≥–∫–æ –¥–æ–ø—É—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

**–í—ã–≤–æ–¥:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `bench execute` –≤–º–µ—Å—Ç–æ standalone —Å–∫—Ä–∏–ø—Ç–æ–≤!

---

## 3. Bench Console: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 3.1 –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Å–æ–ª–∏

**–ë–∞–∑–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞:**
```bash
bench --site <site_name> console
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–π site:
bench --site localhost console

# –ü—Ä–æ–¥–∞–∫—à–Ω site:
bench --site mysite.example.com console

# –ß–µ—Ä–µ–∑ Docker:
docker exec -it backend bench --site localhost console
```

### 3.2 –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ –∫–æ–Ω—Å–æ–ª–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `bench console` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:

```python
>>> import frappe  # ‚úÖ –£–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
>>> frappe.local.site  # ‚úÖ Site –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
'localhost'

>>> frappe.db  # ‚úÖ –ë–î –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
<frappe.database.Database object at 0x...>

>>> frappe.session.user  # ‚úÖ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
'Administrator'
```

### 3.3 –¢–∏–ø–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

#### 3.3.1 –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Read)

```python
# –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç:
>>> doc = frappe.get_doc("User", "Administrator")
>>> print(doc.email)
administrator@example.com

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
>>> users = frappe.get_all("User", 
...     filters={"enabled": 1},
...     fields=["name", "email"])
>>> len(users)
5

# SQL –∑–∞–ø—Ä–æ—Å:
>>> result = frappe.db.sql("""
...     SELECT name, email 
...     FROM `tabUser` 
...     WHERE enabled = 1
... """, as_dict=True)
>>> result[0]
{'name': 'Administrator', 'email': 'administrator@example.com'}
```

#### 3.3.2 –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Create)

```python
# –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç:
>>> doc = frappe.get_doc({
...     "doctype": "ToDo",
...     "description": "Test task",
...     "status": "Open"
... })
>>> doc.insert(ignore_permissions=True)
>>> frappe.db.commit()  # ‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–µ –∑–∞–±—ã—Ç—å commit!
>>> print(f"Created: {doc.name}")
Created: TODO-0001
```

**–ö–†–ò–¢–ò–ß–ù–û:** –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ `frappe.db.commit()` –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π!

#### 3.3.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Update)

```python
# –ü–æ–ª—É—á–∏—Ç—å –∏ –∏–∑–º–µ–Ω–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç:
>>> doc = frappe.get_doc("ToDo", "TODO-0001")
>>> doc.status = "Closed"
>>> doc.save()
>>> frappe.db.commit()

# –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ set_value:
>>> frappe.db.set_value("ToDo", "TODO-0001", "status", "Closed")
>>> frappe.db.commit()
```

#### 3.3.4 –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Delete)

```python
# –£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç:
>>> frappe.delete_doc("ToDo", "TODO-0001", force=1)
>>> frappe.db.commit()

# –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:
>>> todos = frappe.get_all("ToDo", filters={"status": "Closed"})
>>> for todo in todos:
...     frappe.delete_doc("ToDo", todo.name, force=1)
>>> frappe.db.commit()
```

### 3.4 –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ Database API (frappe.db)

#### 3.4.1 frappe.db.get_list() / frappe.get_list()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã DocType —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**
```python
frappe.db.get_list(doctype, filters, or_filters, fields, order_by, group_by, start, page_length)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
# –¢–æ–ª—å–∫–æ –∏–º–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
>>> frappe.db.get_list('Employee')
[{'name': 'HR-EMP-00008'},
 {'name': 'HR-EMP-00006'},
 {'name': 'HR-EMP-00010'}]

# –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–æ–ª—è–º–∏:
>>> frappe.db.get_list('Task',
...     filters={'status': 'Open'},
...     fields=['subject', 'date'],
...     order_by='date desc',
...     start=10,
...     page_length=20)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pluck –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π:
>>> frappe.db.get_list('Employee', pluck='name')
['HR-EMP-00008', 'HR-EMP-00006', 'HR-EMP-00010']

# –§–∏–ª—å—Ç—Ä—ã —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏:
>>> frappe.db.get_list('Task', filters={'date': ['>', '2019-09-08']})

# –î–∏–∞–ø–∞–∑–æ–Ω (BETWEEN):
>>> frappe.db.get_list('Task', filters=[
...     ['date', 'between', ['2020-04-01', '2021-03-31']]
... ])

# LIKE –ø–æ–∏—Å–∫:
>>> frappe.db.get_list('Task', filters={'subject': ['like', '%test%']})

# –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è:
>>> frappe.db.get_list('Task',
...     fields=['count(name) as count', 'status'],
...     group_by='status')
[{'count': 1, 'status': 'Working'},
 {'count': 2, 'status': 'Overdue'},
 {'count': 20, 'status': 'Completed'}]

# –í–æ–∑–≤—Ä–∞—Ç –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ –∫–æ—Ä—Ç–µ–∂–µ–π:
>>> frappe.db.get_list('Task',
...     fields=['subject', 'date'],
...     as_list=True)
(('Update Branding', '2019-09-04'),
 ('Missing Documentation', '2019-09-02'))
```

**–í–ê–ñ–ù–û:** `get_list()` –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞! –î–ª—è –æ–±—Ö–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `get_all()`.

---

#### 3.4.2 frappe.db.get_all() / frappe.get_all()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–¢–æ –∂–µ —á—Ç–æ `get_list()`, –Ω–æ **–ë–ï–ó** –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

```python
# –ü–æ–ª—É—á–∏—Ç—å –í–°–ï –∑–∞–ø–∏—Å–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–∞–≤:
>>> frappe.db.get_all('User', fields=['name', 'email'])
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –í Server Scripts –≥–¥–µ –Ω—É–∂–Ω—ã –≤—Å–µ –∑–∞–ø–∏—Å–∏
- –í —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á–∞—Ö
- –í –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö

---

#### 3.4.3 frappe.db.get_value() / frappe.get_value()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è (–∏–ª–∏ –ø–æ–ª–µ–π) –¥–æ–∫—É–º–µ–Ω—Ç–∞.

**–í–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–∑–æ–≤–∞:**
```python
# –û–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:
>>> subject = frappe.db.get_value('Task', 'TASK00002', 'subject')

# –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π:
>>> subject, description = frappe.db.get_value('Task', 'TASK00002', 
...     ['subject', 'description'])

# –ö–∞–∫ —Å–ª–æ–≤–∞—Ä—å:
>>> task_dict = frappe.db.get_value('Task', 'TASK00002',
...     ['subject', 'description'], as_dict=True)
>>> task_dict.subject
>>> task_dict.description

# –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (–≤–µ—Ä–Ω–µ—Ç –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å):
>>> subject, description = frappe.db.get_value('Task',
...     {'status': 'Open'},
...     ['subject', 'description'])
```

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º `get_doc()` –∫–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π.

---

#### 3.4.4 frappe.db.get_single_value()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –∏–∑ Single DocType.

```python
# Single DocTypes –Ω–µ –∏–º–µ—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:
>>> timezone = frappe.db.get_single_value('System Settings', 'timezone')
>>> print(timezone)
'Asia/Kolkata'
```

---

#### 3.4.5 frappe.db.set_value() / frappe.db.update()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –≤ –ë–î –Ω–∞–ø—Ä—è–º—É—é. **–ù–ï** –≤—ã–∑—ã–≤–∞–µ—Ç ORM —Ç—Ä–∏–≥–≥–µ—Ä—ã (`validate`, `on_update`).

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
```python
# –û–¥–Ω–æ –ø–æ–ª–µ:
>>> frappe.db.set_value('Task', 'TASK00002', 'subject', 'New Subject')

# –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π:
>>> frappe.db.set_value('Task', 'TASK00002', {
...     'subject': 'New Subject',
...     'description': 'New Description'
... })

# –ë–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è modified:
>>> frappe.db.set_value('Task', 'TASK00002', 'subject', 'New Subject',
...     update_modified=False)
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:**  
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç:
- `validate()` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—é
- `on_update()` ‚Äî —Ö—É–∫–∏ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- `before_save()` ‚Äî —Ö—É–∫–∏ –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö –ø–æ–ª–µ–π
- –ú–∞—Å—Å–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ö–æ–≥–¥–∞ —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç–µ —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ

**–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ö–æ–≥–¥–∞ –µ—Å—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ

---

#### 3.4.6 frappe.db.exists()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
```python
# –ë–∞–∑–æ–≤—ã–π –≤—ã–∑–æ–≤:
>>> frappe.db.exists("User", "jane@example.org")
True

# –° –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö):
>>> frappe.db.exists("User", "jane@example.org", cache=True)

# –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (—Å–ª–æ–≤–∞—Ä—å —Å doctype):
>>> frappe.db.exists({"doctype": "User", "full_name": "Jane Doe"})

# –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (–æ—Ç–¥–µ–ª—å–Ω–æ doctype –∏ —Ñ–∏–ª—å—Ç—Ä—ã):
>>> frappe.db.exists("User", {"full_name": "Jane Doe"})
```

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º `get_doc()` –≤ try/except.

---

#### 3.4.7 frappe.db.count()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π.

```python
# –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:
>>> frappe.db.count('Task')
145

# –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:
>>> frappe.db.count('Task', {'status': 'Open'})
23
```

---

#### 3.4.8 frappe.db.delete()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º. **DML –∫–æ–º–∞–Ω–¥–∞** (–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ rollback).

```python
# –£–¥–∞–ª–∏—Ç—å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:
>>> frappe.db.delete("Route History", {
...     "modified": ("<=", "2024-01-01"),
...     "user": "john@example.com"
... })

# –£–¥–∞–ª–∏—Ç—å –í–°–ï –∑–∞–ø–∏—Å–∏ DocType:
>>> frappe.db.delete("Error Log")

# –£–¥–∞–ª–∏—Ç—å –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ç–∞–±–ª–∏—Ü—ã:
>>> frappe.db.delete("__Test Table")
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —É–¥–∞–ª–∏—Ç –í–°–ï –∑–∞–ø–∏—Å–∏!

---

#### 3.4.9 frappe.db.truncate()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª–Ω–æ—Å—Ç—å—é. **DDL –∫–æ–º–∞–Ω–¥–∞** (–ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ rollback!).

```python
>>> frappe.db.truncate("Error Log")
>>> frappe.db.truncate("__Test Table")
```

**–ö–†–ò–¢–ò–ß–ù–û:**  
- –í—ã–ø–æ–ª–Ω—è–µ—Ç `TRUNCATE TABLE` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π commit
- **–ù–ï–õ–¨–ó–Ø** –æ—Ç–∫–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ `rollback()`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤

**–†–∞–∑–Ω–∏—Ü–∞ —Å delete():**

| –ú–µ—Ç–æ–¥ | –ö–æ–º–∞–Ω–¥–∞ SQL | –û—Ç–∫–∞—Ç | –°–∫–æ—Ä–æ—Å—Ç—å | –¢—Ä–∏–≥–≥–µ—Ä—ã |
|-------|-------------|-------|----------|----------|
| `delete()` | DELETE | ‚úÖ –î–∞ | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ | ‚úÖ –î–∞ |
| `truncate()` | TRUNCATE | ‚ùå –ù–µ—Ç | –ë—ã—Å—Ç—Ä–µ–µ | ‚ùå –ù–µ—Ç |

---

#### 3.4.10 frappe.db.commit()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –í—ã–∑—ã–≤–∞–µ—Ç SQL `COMMIT`.

```python
>>> doc.insert()
>>> frappe.db.commit()  # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

**–í–ê–ñ–ù–û:** –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ commit –¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ POST/PUT –∑–∞–ø—Ä–æ—Å–∞
- –ü–æ—Å–ª–µ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- –ü–æ—Å–ª–µ –ø–∞—Ç—á–µ–π

**–†—É—á–Ω–æ–π commit –Ω—É–∂–µ–Ω:**
- –í `bench console`
- –í `bench execute` —Å–∫—Ä–∏–ø—Ç–∞—Ö
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

#### 3.4.11 frappe.db.rollback()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–û—Ç–∫–∞—Ç–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –í—ã–∑—ã–≤–∞–µ—Ç SQL `ROLLBACK`.

```python
try:
    doc.insert()
    frappe.db.commit()
except Exception as e:
    frappe.db.rollback()  # –û—Ç–∫–∞—Ç–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
    print(f"Error: {e}")
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback:**  
Frappe –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç `rollback()` –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö –≤ POST/PUT –∑–∞–ø—Ä–æ—Å–∞—Ö.

**Rollback —Å savepoint:**
```python
# –û—Ç–∫–∞—Ç–∏—Ç—å –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
>>> frappe.db.rollback(save_point="my_savepoint")
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** Rollback –∫ savepoint –ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- –í–Ω–µ—à–Ω–∏–µ API –≤—ã–∑–æ–≤—ã
- Email –æ—Ç–ø—Ä–∞–≤–∫–∏

---

#### 3.4.12 frappe.db.savepoint()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–°–æ–∑–¥–∞—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—É—é —Ç–æ—á–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞.

```python
# –°–æ–∑–¥–∞—Ç—å savepoint:
>>> frappe.db.savepoint("before_risky_operation")

try:
    # –†–∏—Å–∫–æ–≤–∞–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    risky_operation()
except Exception:
    # –û—Ç–∫–∞—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ savepoint
    frappe.db.rollback(save_point="before_risky_operation")
```

---

#### 3.4.13 frappe.db.sql()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å.

**–ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å:
>>> data = frappe.db.sql("""
...     SELECT name, email
...     FROM `tabUser`
...     WHERE enabled = 1
... """, as_dict=True)

# –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection):
>>> values = {'company': 'Frappe Technologies Inc'}
>>> data = frappe.db.sql("""
...     SELECT acc.account_number, gl.debit, gl.credit
...     FROM `tabGL Entry` gl
...     LEFT JOIN `tabAccount` acc ON gl.account = acc.name
...     WHERE gl.company = %(company)s
... """, values=values, as_dict=True)

# –ö–∞–∫ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π:
>>> data = frappe.db.sql("SELECT name, email FROM `tabUser`", as_dict=False)
[('Administrator', 'admin@example.com'), ...]
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL injection
- –ù–∞–∑–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü: `tabDocType Name` (—Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `tab`)
- –ò–∑–±–µ–≥–∞–π—Ç–µ `sql()` –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ORM –º–µ—Ç–æ–¥—ã

---

#### 3.4.14 frappe.db.multisql()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –°–£–ë–î (MariaDB/Postgres).

```python
>>> frappe.db.multisql({
...     'mariadb': "SELECT * FROM `tabUser` LIMIT 10",
...     'postgres': "SELECT * FROM \"tabUser\" LIMIT 10"
... })
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
–ö–æ–≥–¥–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQL —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É MariaDB –∏ PostgreSQL.

---

#### 3.4.15 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**frappe.db.add_index()** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å:
```python
>>> frappe.db.add_index("Notes", ["id(10)", "content(500)"], "idx_notes")
```

**frappe.db.add_unique()** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å unique constraint:
```python
>>> frappe.db.add_unique("DocType", ["field1", "field2"])
```

**frappe.db.describe()** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
```python
>>> frappe.db.describe("User")
```

**frappe.db.change_column_type()** ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø –∫–æ–ª–æ–Ω–∫–∏:
```python
>>> frappe.db.change_column_type("User", "phone", "varchar(20)")
```

**frappe.db.rename_table()** ‚Äî –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É:
```python
>>> frappe.db.rename_table("__old_table", "__new_table")
```

**‚ö†Ô∏è –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è DocType —Ç–∞–±–ª–∏—Ü! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `frappe.rename_doc()`.

---

#### 3.4.16 Transaction Hooks (–•—É–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ/–ø–æ—Å–ª–µ commit/rollback.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ö—É–∫–∏:**
- `frappe.db.before_commit.add(func)`
- `frappe.db.after_commit.add(func)`
- `frappe.db.before_rollback.add(func)`
- `frappe.db.after_rollback.add(func)`

**–ü—Ä–∏–º–µ—Ä:**
```python
def create_file(self):
    self.write_file()
    # –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ø—Ä–∏ rollback
    frappe.db.after_rollback.add(self.rollback_file)

def rollback_file(self):
    self.delete_file()
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Å –ë–î
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º commit
- –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ rollback

---

### 3.5 –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ Document API

#### 3.5.1 frappe.get_doc()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –≤ –ø–∞–º—è—Ç–∏.

**–í–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–∑–æ–≤–∞:**

```python
# 1. –ü–æ–ª—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç:
>>> doc = frappe.get_doc('Task', 'TASK00002')
>>> doc.title = 'Updated Title'
>>> doc.save()

# 2. –ü–æ–ª—É—á–∏—Ç—å Single DocType (–±–µ–∑ name):
>>> doc = frappe.get_doc('System Settings')
>>> print(doc.timezone)  # Asia/Kolkata

# 3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (—Å–ª–æ–≤–∞—Ä—å):
>>> doc = frappe.get_doc({
...     'doctype': 'Task',
...     'title': 'New Task',
...     'status': 'Open'
... })
>>> doc.insert()

# 4. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (kwargs):
>>> doc = frappe.get_doc(
...     doctype='User',
...     email='test@example.com',
...     first_name='Test'
... )
>>> doc.insert()
```

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `frappe.DoesNotExistError` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

---

#### 3.5.2 frappe.get_last_doc()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.

```python
# –ü–æ—Å–ª–µ–¥–Ω–∏–π Task:
>>> task = frappe.get_last_doc('Task')

# –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:
>>> task = frappe.get_last_doc('Task', filters={"status": "Cancelled"})

# –° custom —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π:
>>> task = frappe.get_last_doc('Task',
...     filters={"status": "Open"},
...     order_by="timestamp desc")
```

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `creation desc`.

---

#### 3.5.3 frappe.get_cached_doc()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–¢–æ –∂–µ —á—Ç–æ `get_doc()`, –Ω–æ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫—ç—à–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ –ë–î.

```python
>>> doc = frappe.get_cached_doc('User', 'Administrator')
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (System Settings, User, etc.)
- –î–æ–∫—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è

---

#### 3.5.4 frappe.new_doc()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

```python
>>> doc = frappe.new_doc('Task')
>>> doc.title = 'New Task 2'
>>> doc.status = 'Open'
>>> doc.insert()
```

---

#### 3.5.5 frappe.delete_doc()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (Comments, Communications, etc.).

```python
# –ë–∞–∑–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:
>>> frappe.delete_doc('Task', 'TASK00002')

# –° –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∞–≤:
>>> frappe.delete_doc('Task', 'TASK00002',
...     force=1,
...     ignore_permissions=True)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `force=1` ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ (submit status, etc.)
- `ignore_permissions=True` ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

---

#### 3.5.6 frappe.rename_doc()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç (–∏–∑–º–µ–Ω–∏—Ç—å primary key).

```python
# –ë–∞–∑–æ–≤–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:
>>> frappe.rename_doc('Task', 'TASK00002', 'TASK00003')

# –°–æ —Å–ª–∏—è–Ω–∏–µ–º:
>>> frappe.rename_doc('Task', 'TASK00002', 'TASK00003', merge=True)
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:**  
–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ DocType –≤–∫–ª—é—á–µ–Ω–æ `Allow Rename`.

---

#### 3.5.7 frappe.get_meta()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ DocType (–≤–∫–ª—é—á–∞—è custom fields).

```python
>>> meta = frappe.get_meta('Task')
>>> meta.has_field('status')  # True
>>> meta.get_custom_fields()  # [field1, field2, ...]
>>> meta.istable  # False
>>> meta.is_tree  # False
```

**–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ DocType (–±–µ–∑ custom fields):**
```python
>>> doctype_doc = frappe.get_doc('DocType', 'Task')
```

---

#### 3.5.8 doc.insert()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –≤ –ë–î. –í—ã–∑—ã–≤–∞–µ—Ç `before_insert`, `validate`, `on_update`, `after_insert`.

```python
>>> doc = frappe.get_doc({'doctype': 'Task', 'title': 'New Task'})
>>> doc.insert(
...     ignore_permissions=True,     # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞
...     ignore_links=True,            # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å Link –≤–∞–ª–∏–¥–∞—Ü–∏—é
...     ignore_if_duplicate=True,     # –ù–µ –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –¥—É–±–ª–∏–∫–∞—Ç–µ
...     ignore_mandatory=True         # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
... )
```

---

#### 3.5.9 doc.save()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ. –í—ã–∑—ã–≤–∞–µ—Ç `validate`, `on_update`.

```python
>>> doc = frappe.get_doc('Task', 'TASK00002')
>>> doc.status = 'Completed'
>>> doc.save(
...     ignore_permissions=True,  # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞
...     ignore_version=True       # –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é
... )
```

---

#### 3.5.10 doc.delete()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç. –ê–ª–∏–∞—Å –¥–ª—è `frappe.delete_doc()`.

```python
>>> doc = frappe.get_doc('Task', 'TASK00002')
>>> doc.delete()
```

---

#### 3.5.11 doc.reload()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∏–∑ –ë–î (–ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è).

```python
>>> doc = frappe.get_doc('Task', 'TASK00002')
# ... –¥—Ä—É–≥–æ–π –∫–æ–¥ –∏–∑–º–µ–Ω–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç –≤ –ë–î ...
>>> doc.reload()  # –û–±–Ω–æ–≤–∏—Ç—å –∏–∑ –ë–î
```

---

#### 3.5.12 doc.get_doc_before_save()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–æ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

```python
>>> doc = frappe.get_doc('Task', 'TASK00002')
>>> old_doc = doc.get_doc_before_save()
>>> if old_doc.price != doc.price:
...     print("Price changed!")
```

---

#### 3.5.13 doc.db_set()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î, –æ–±–Ω–æ–≤–∏—Ç—å `modified`. **–ù–ï** –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é.

```python
# –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
>>> doc.db_set('price', 2300)

# –° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º:
>>> doc.db_set('price', 2300, notify=True)

# –° commit:
>>> doc.db_set('price', 2300, commit=True)

# –ë–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è modified:
>>> doc.db_set('price', 2300, update_modified=False)
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –ù–µ –≤—ã–∑—ã–≤–∞–µ—Ç `validate()` –∏ `on_update()`!

---

#### 3.5.14 doc.append()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ child table.

```python
>>> doc = frappe.get_doc('Sales Order', 'SO-0001')
>>> doc.append("items", {
...     "item_code": "ITEM-001",
...     "qty": 5,
...     "rate": 100
... })
>>> doc.save()
```

---

#### 3.5.15 doc.check_permission()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞. –ë—Ä–æ—Å–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤.

```python
>>> doc.check_permission(permtype='write')  # Throws –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤
```

---

#### 3.5.16 doc.get_url()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å URL –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ Desk.

```python
>>> doc = frappe.get_doc('Task', 'TASK00002')
>>> url = doc.get_url()  # /app/task/TASK00002
```

---

#### 3.5.17 doc.add_comment()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ Timeline).

```python
# –ü—Ä–æ—Å—Ç–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:
>>> doc.add_comment('Comment', text='Test Comment')

# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ç–∏–ø–∞ Edit:
>>> doc.add_comment('Edit', 'Values changed')

# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ç–∏–ø–∞ Shared:
>>> doc.add_comment("Shared",
...     f"{user} shared this document with everyone")
```

---

#### 3.5.18 doc.add_tag()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥ –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É.

```python
>>> doc.add_tag('developer')
>>> doc.add_tag('frontend')
```

---

#### 3.5.19 doc.get_tags()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

```python
>>> tags = doc.get_tags()
>>> print(tags)  # ['developer', 'frontend']
```

---

#### 3.5.20 doc.add_seen() / doc.add_viewed()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–û—Ç–º–µ—Ç–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π.

```python
# –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
>>> doc.add_seen()
>>> doc.add_viewed()

# –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
>>> doc.add_seen('john@doe.com')
>>> doc.add_viewed('john@doe.com')
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**  
- `add_seen()` ‚Äî DocType –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å `Track Seen`
- `add_viewed()` ‚Äî DocType –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å `Track Views`

---

#### 3.5.21 doc.run_method()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –≤–∫–ª—é—á–∞—è —Ö—É–∫–∏.

```python
>>> doc.run_method('validate')
>>> doc.run_method('custom_method', arg1='value1')
```

---

#### 3.5.22 doc.queue_action()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–µ—Ç–æ–¥ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

```python
>>> doc.queue_action('send_emails',
...     emails=email_list,
...     message='Howdy')
```

---

#### 3.5.23 Tree DocType –º–µ—Ç–æ–¥—ã

**doc.get_children()** ‚Äî –ø–æ–ª—É—á–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã:
```python
>>> for child_doc in doc.get_children():
...     print(child_doc.name)
...     for grandchild_doc in child_doc.get_children():
...         print(f"  {grandchild_doc.name}")
```

**doc.get_parent()** ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª:
```python
>>> parent_doc = doc.get_parent()
>>> grandparent_doc = parent_doc.get_parent()
```

---

#### 3.5.24 –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ)

**doc.db_insert()** ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```python
>>> doc = frappe.get_doc(doctype="Test", data="value")
>>> doc.db_insert()  # –ë–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ö—É–∫–æ–≤!
```

**doc.db_update()** ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```python
>>> doc = frappe.get_last_doc("User")
>>> doc.last_active = frappe.utils.now()
>>> doc.db_update()  # –ë–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ö—É–∫–æ–≤!
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û:** –≠—Ç–∏ –º–µ—Ç–æ–¥—ã –æ–±—Ö–æ–¥—è—Ç:
- –í–∞–ª–∏–¥–∞—Ü–∏—é (`validate()`)
- –•—É–∫–∏ (`before_insert`, `on_update`, etc.)
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç–µ —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ!

---

### 3.6 –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

#### –û—à–∏–±–∫–∞ 1: –ó–∞–±—ã–ª–∏ commit
```python
>>> doc = frappe.get_doc({"doctype": "ToDo", "description": "Test"})
>>> doc.insert()
>>> # –û–®–ò–ë–ö–ê: –ó–∞–±—ã–ª–∏ frappe.db.commit()
>>> # –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—è–Ω—ã!
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
>>> frappe.db.commit()  # ‚úÖ –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å commit
```

#### –û—à–∏–±–∫–∞ 2: –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å heredoc

```bash
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
bench --site localhost console << 'EOF'
print("Hello")
EOF
# ‚Üí –ö–æ–Ω—Å–æ–ª—å –∑–∞–≤–∏—Å–Ω–µ—Ç, –æ–∂–∏–¥–∞—è –≤–≤–æ–¥–∞
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `bench execute` –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤!

#### –û—à–∏–±–∫–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç

```python
>>> from frappe import get_doc  # ‚ùå –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
>>> doc = get_doc("User", "Administrator")  # ‚ùå –û—à–∏–±–∫–∞
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
>>> import frappe  # ‚úÖ –í—Å–µ–≥–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å frappe —Ü–µ–ª–∏–∫–æ–º
>>> doc = frappe.get_doc("User", "Administrator")  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

---

## 4. Bench Execute: –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –º–µ—Ç–æ–¥

### 4.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
apps/
‚îî‚îÄ‚îÄ your_app/
    ‚îî‚îÄ‚îÄ your_app/
        ‚îú‚îÄ‚îÄ __init__.py
        ‚îî‚îÄ‚îÄ scripts/
            ‚îú‚îÄ‚îÄ __init__.py
            ‚îú‚îÄ‚îÄ import_data.py
            ‚îú‚îÄ‚îÄ cleanup.py
            ‚îî‚îÄ‚îÄ utils.py
```

### 4.2 –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Å–∫—Ä–∏–ø—Ç–∞

```python
# apps/your_app/your_app/scripts/import_data.py
import frappe

def import_all():
    """
    –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
    –í—ã–∑–æ–≤: bench --site localhost execute your_app.scripts.import_data.import_all
    """
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç –£–ñ–ï –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω bench execute
    # –ù–ï –ù–£–ñ–ù–û: frappe.init(), frappe.connect()
    
    print("Starting import...")
    
    # –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    data = [
        {"name": "Item 1", "status": "Active"},
        {"name": "Item 2", "status": "Active"},
    ]
    
    for item in data:
        create_item(item)
    
    # Commit –≤ –∫–æ–Ω—Ü–µ
    frappe.db.commit()
    print(f"‚úÖ Import completed: {len(data)} items")

def create_item(item_data):
    """–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    if not frappe.db.exists("Item", item_data["name"]):
        doc = frappe.get_doc({
            "doctype": "Item",
            **item_data
        })
        doc.insert(ignore_permissions=True)
        print(f"  Created: {doc.name}")
```

### 4.3 –°–∫—Ä–∏–ø—Ç —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏

```python
# apps/your_app/your_app/scripts/import_data.py
import frappe
import json

def import_specific(doctype, json_data):
    """
    –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ DocType
    
    Args:
        doctype: str - –ò–º—è DocType
        json_data: str - JSON —Å—Ç—Ä–æ–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
    
    –í—ã–∑–æ–≤:
        bench --site localhost execute \
          your_app.scripts.import_data.import_specific \
          --args '["ToDo", "[{\"description\": \"Task 1\"}]"]'
    """
    # –ü–∞—Ä—Å–∏—Ç—å JSON –∞—Ä–≥—É–º–µ–Ω—Ç
    data = json.loads(json_data)
    
    for item in data:
        doc = frappe.get_doc({
            "doctype": doctype,
            **item
        })
        doc.insert(ignore_permissions=True)
        print(f"Created: {doc.name}")
    
    frappe.db.commit()
```

**–ó–∞–ø—É—Å–∫:**
```bash
bench --site localhost execute \
  your_app.scripts.import_data.import_specific \
  --args '["ToDo", "[{\"description\": \"Task 1\"}, {\"description\": \"Task 2\"}]"]'
```

### 4.4 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
import frappe

def safe_import():
    """
    –ò–º–ø–æ—Ä—Ç —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
    """
    success = 0
    errors = 0
    
    data = get_data()  # –í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    
    for item in data:
        try:
            doc = frappe.get_doc({
                "doctype": "Item",
                **item
            })
            doc.insert(ignore_permissions=True)
            success += 1
            
            # Commit –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
            frappe.db.commit()
            
        except Exception as e:
            errors += 1
            print(f"‚ùå Error creating {item.get('name')}: {str(e)}")
            
            # Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
            frappe.db.rollback()
            
            # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ Error Log
            frappe.log_error(
                title=f"Import Error: {item.get('name')}",
                message=frappe.get_traceback()
            )
    
    print(f"\n‚úÖ Success: {success}")
    print(f"‚ùå Errors: {errors}")
```

---

## 5. –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### 5.1 –û—à–∏–±–∫–∞: AttributeError - NoneType site

**–û—à–∏–±–∫–∞:**
```python
AttributeError: 'NoneType' object has no attribute 'site'
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
Frappe –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
import frappe
doc = frappe.get_doc("User", "Administrator")

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (standalone —Å–∫—Ä–∏–ø—Ç):
import frappe
frappe.init(site='localhost')
frappe.connect()
doc = frappe.get_doc("User", "Administrator")

# ‚úÖ –õ–£–ß–®–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ bench execute
```

---

### 5.2 –û—à–∏–±–∫–∞: TypeError - cannot unpack non-iterable NoneType

**–û—à–∏–±–∫–∞:**
```python
TypeError: cannot unpack non-iterable NoneType object
```

**–ü—Ä–∏—á–∏–Ω–∞ (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ NestedSet):**  
–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –î–û —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ.

**–ü—Ä–∏–º–µ—Ä:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –†–æ–¥–∏—Ç–µ–ª—å FST-0001 –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
doc = frappe.get_doc({
    "doctype": "Folder Structure Template",
    "name": "FST-0004",
    "parent_folder_structure_template": "FST-0001"  # ‚Üê –ù–ï –°–û–ó–î–ê–ù!
})
doc.insert()
# ‚Üí TypeError –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ lft/rgt
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è
parent = frappe.get_doc({
    "doctype": "Folder Structure Template",
    "name": "FST-0001",
    "parent_folder_structure_template": None,
    "is_group": 1
})
parent.insert()
frappe.db.commit()

# –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç
child = frappe.get_doc({
    "doctype": "Folder Structure Template",
    "name": "FST-0004",
    "parent_folder_structure_template": "FST-0001"  # ‚Üê –†–æ–¥–∏—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ
})
child.insert()
frappe.db.commit()
```

---

### 5.3 –û—à–∏–±–∫–∞: –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
>>> doc = frappe.get_doc("User", "Administrator")
>>> doc.email = "new@example.com"
>>> doc.save()
>>> # –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
>>> # –í—Ö–æ–¥ —Å–Ω–æ–≤–∞ ‚Üí email –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è!
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–ó–∞–±—ã–ª–∏ —Å–¥–µ–ª–∞—Ç—å `frappe.db.commit()`.

**–†–µ—à–µ–Ω–∏–µ:**
```python
>>> doc = frappe.get_doc("User", "Administrator")
>>> doc.email = "new@example.com"
>>> doc.save()
>>> frappe.db.commit()  # ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
```

---

### 5.4 –û—à–∏–±–∫–∞: frappe.DoesNotExistError

**–û—à–∏–±–∫–∞:**
```python
frappe.exceptions.DoesNotExistError: User not found
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
doc = frappe.get_doc("User", "nonexistent@example.com")

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
if frappe.db.exists("User", "nonexistent@example.com"):
    doc = frappe.get_doc("User", "nonexistent@example.com")
else:
    print("User does not exist")
```

---

### 5.5 –û—à–∏–±–∫–∞: PermissionError

**–û—à–∏–±–∫–∞:**
```python
frappe.exceptions.PermissionError: You do not have permission to create User
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
doc.insert()

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤
doc.insert(ignore_permissions=True)

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
frappe.set_user("Administrator")
doc.insert()
```

---

### 5.6 –û—à–∏–±–∫–∞: –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ NestedSet

**–û—à–∏–±–∫–∞:**
```python
frappe.exceptions.ValidationError: Cannot create circular reference
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–ü–æ–ø—ã—Ç–∫–∞ —Å–¥–µ–ª–∞—Ç—å —É–∑–µ–ª —Ä–æ–¥–∏—Ç–µ–ª–µ–º —Å–∞–º–æ–≥–æ —Å–µ–±—è –∏–ª–∏ –µ–≥–æ –ø–æ—Ç–æ–º–∫–∞.

**–ü—Ä–∏–º–µ—Ä:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
doc = frappe.get_doc("Account", "Assets")
doc.parent_account = "Assets"  # ‚Üê –°–∞–º —Å–µ–±–µ —Ä–æ–¥–∏—Ç–µ–ª—å!
doc.save()
# ‚Üí ValidationError
```

**–†–µ—à–µ–Ω–∏–µ:**  
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.

---

## 6. –†–∞–±–æ—Ç–∞ —Å NestedSet —á–µ—Ä–µ–∑ Python

### 6.1 –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å NestedSet

**–ö–†–ò–¢–ò–ß–ù–û:** –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Tree DocTypes (NestedSet) —Å–æ–±–ª—é–¥–∞–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫:
- **–°–æ–∑–¥–∞–Ω–∏–µ:** –†–æ–¥–∏—Ç–µ–ª–∏ –ü–ï–†–ï–î –¥–µ—Ç—å–º–∏ (breadth-first)
- **–£–¥–∞–ª–µ–Ω–∏–µ:** –î–µ—Ç–∏ –ü–ï–†–ï–î —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ (–ª–∏—Å—Ç—å—è ‚Üí –∫–æ—Ä–Ω–∏)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** https://github.com/frappe/frappe/blob/develop/frappe/utils/nestedset.py

### 6.2 –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:** –ò–º—è –ø–æ–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è –≤ Tree DocType —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª—É:
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `parent_{doctype_name_scrubbed}`
- –ù–∞–ø—Ä–∏–º–µ—Ä: `parent_account`, `parent_item_group`, `parent_folder_structure_template`
- **–ò–ª–∏ —á–µ—Ä–µ–∑:** —Å–≤–æ–π—Å—Ç–≤–æ `nsm_parent_field` –≤ –∫–ª–∞—Å—Å–µ DocType

```python
import frappe

def create_tree_nodes():
    """
    –°–æ–∑–¥–∞—Ç—å —É–∑–ª—ã –¥–µ—Ä–µ–≤–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
    """
    # Level 0: –ö–æ—Ä–Ω–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (parent = None –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞)
    roots = [
        {"name": "ROOT-1", "parent": None, "is_group": 1},
        {"name": "ROOT-2", "parent": None, "is_group": 1},
    ]
    
    for data in roots:
        create_node("Account", data)
    
    frappe.db.commit()  # Commit –ø–æ—Å–ª–µ —É—Ä–æ–≤–Ω—è
    
    # Level 1: –î–µ—Ç–∏ –∫–æ—Ä–Ω–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    children = [
        {"name": "CHILD-1", "parent": "ROOT-1", "is_group": 1},
        {"name": "CHILD-2", "parent": "ROOT-2", "is_group": 0},
    ]
    
    for data in children:
        create_node("Account", data)
    
    frappe.db.commit()  # Commit –ø–æ—Å–ª–µ —É—Ä–æ–≤–Ω—è
    
    # Level 2: –í–Ω—É–∫–∏
    grandchildren = [
        {"name": "GRANDCHILD-1", "parent": "CHILD-1", "is_group": 0},
    ]
    
    for data in grandchildren:
        create_node("Account", data)
    
    frappe.db.commit()  # Commit –ø–æ—Å–ª–µ —É—Ä–æ–≤–Ω—è

def create_node(doctype, data):
    """–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —É–∑–ª–∞"""
    if not frappe.db.exists(doctype, data["name"]):
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª–µ —Ä–æ–¥–∏—Ç–µ–ª—è (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–µ nestedset.py)
        parent_field = f"parent_{frappe.scrub(doctype)}"
        # frappe.scrub() –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç "Item Group" -> "item_group"
        
        doc = frappe.get_doc({
            "doctype": doctype,
            "name": data["name"],
            parent_field: data.get("parent") or "",  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –∫–æ—Ä–Ω—è
            "is_group": data.get("is_group", 0)
        })
        doc.insert(ignore_permissions=True)
        print(f"‚úÖ Created: {doc.name}")
```

**–ó–∞–ø—É—Å–∫:**
```bash
bench --site localhost execute your_app.scripts.tree.create_tree_nodes
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ —É–∑–ª–æ–≤ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è:
```python
# –í –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:
frappe.flags.in_import = True  # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
frappe.db.auto_commit_on_many_writes = True  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π commit

# –í–∞—à –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —É–∑–ª–æ–≤...

# –í –∫–æ–Ω—Ü–µ:
frappe.flags.in_import = False
```

### 6.3 –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏

```python
import frappe

def delete_tree_nodes(doctype):
    """
    –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —É–∑–ª—ã –¥–µ—Ä–µ–≤–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ª–∏—Å—Ç—å—è ‚Üí –∫–æ—Ä–Ω–∏)
    
    Args:
        doctype: str - –ò–º—è Tree DocType (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Account")
    """
    # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ rgt DESC
    # rgt (right boundary) –±–æ–ª—å—à–µ —É –ª–∏—Å—Ç—å–µ–≤, –º–µ–Ω—å—à–µ —É –∫–æ—Ä–Ω–µ–π
    records = frappe.db.sql(f"""
        SELECT name, lft, rgt
        FROM `tab{doctype}`
        ORDER BY rgt DESC
    """, as_dict=True)
    
    print(f"Found {len(records)} records to delete")
    
    deleted = 0
    for record in records:
        try:
            frappe.delete_doc(
                doctype, 
                record.name, 
                force=1,  # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
                ignore_permissions=True
            )
            deleted += 1
            
            if deleted % 10 == 0:
                print(f"Deleted: {deleted}/{len(records)}")
                
        except Exception as e:
            print(f"‚ùå Error deleting {record.name}: {str(e)}")
    
    # Commit –≤ –∫–æ–Ω—Ü–µ (–Ω–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏!)
    frappe.db.commit()
    print(f"\n‚úÖ Deleted {deleted} records")
```

**–ó–∞–ø—É—Å–∫:**
```bash
bench --site localhost execute \
  your_app.scripts.tree.delete_tree_nodes \
  --args '["Account"]'
```

### 6.4 Rebuild Tree (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ lft/rgt)

```python
import frappe
from frappe.utils.nestedset import rebuild_tree

def rebuild_account_tree():
    """
    –ü–µ—Ä–µ—Å—Ç—Ä–æ–∏—Ç—å –¥–µ—Ä–µ–≤–æ Account (–ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å lft/rgt)
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ lft/rgt —Å—Ç–∞–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏
    """
    # –° –≤–µ—Ä—Å–∏–∏ v15+ –ø–∞—Ä–∞–º–µ—Ç—Ä parent_field –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
    # –ü–æ–ª–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ DocType
    rebuild_tree("Account")
    frappe.db.commit()
    print("‚úÖ Tree rebuilt successfully")
```

**–í–ê–ñ–ù–û (—Å –≤–µ—Ä—Å–∏–∏ v15+):**
- –í—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä `parent_field` —Ç–µ–ø–µ—Ä—å **–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è** –∏ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –≤ v16+
- –ü–æ–ª–µ —Ä–æ–¥–∏—Ç–µ–ª—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `meta.nsm_parent_field` –∏–ª–∏ –ø–æ –ø—Ä–∞–≤–∏–ª—É `parent_{scrubbed_doctype}`
- –§—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ "System Manager" –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —á–µ—Ä–µ–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —Å—Ç–æ—Ä–æ–Ω—É

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
- –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ç–∏–ø–∞ "Invalid lft/rgt values"

---

## 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –º–µ—Ç–æ–¥—ã Frappe

### 7.1 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏

#### 7.1.1 frappe.set_user()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π.

```python
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Administrator:
>>> frappe.set_user("Administrator")

# –¢–µ–ø–µ—Ä—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ Administrator
>>> doc = frappe.get_doc({'doctype': 'User', 'email': 'test@example.com'})
>>> doc.insert()  # ‚úÖ –° –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í bench console (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ Administrator)

---

#### 7.1.2 frappe.session.user

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```python
>>> print(frappe.session.user)
'Administrator'
```

---

#### 7.1.3 frappe.has_permission()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ DocType:
>>> frappe.has_permission('User', 'write', user='john@example.com')
True

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:
>>> frappe.has_permission('Task', ptype='write', doc='TASK00002')
```

---

### 7.2 –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º

#### 7.2.1 frappe.utils.now()

```python
>>> from frappe.utils import now
>>> print(now())  # '2025-11-25 14:30:00'
```

#### 7.2.2 frappe.utils.today()

```python
>>> from frappe.utils import today
>>> print(today())  # '2025-11-25'
```

#### 7.2.3 frappe.utils.add_days()

```python
>>> from frappe.utils import add_days, today
>>> tomorrow = add_days(today(), 1)
>>> week_ago = add_days(today(), -7)
```

#### 7.2.4 frappe.utils.getdate()

```python
>>> from frappe.utils import getdate
>>> date = getdate('2025-11-25')  # datetime.date –æ–±—ä–µ–∫—Ç
```

---

### 7.3 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

#### 7.3.1 frappe.log_error()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ó–∞–ø–∏—Å–∞—Ç—å –æ—à–∏–±–∫—É –≤ Error Log.

```python
try:
    risky_operation()
except Exception as e:
    frappe.log_error(
        title="Risky Operation Failed",
        message=frappe.get_traceback()
    )
```

---

#### 7.3.2 frappe.get_traceback()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π traceback —Ç–µ–∫—É—â–µ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

```python
try:
    1 / 0
except:
    error_trace = frappe.get_traceback()
    print(error_trace)
```

---

#### 7.3.3 frappe.errprint() / frappe.msgprint()

```python
# –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):
>>> frappe.errprint("Debug message")

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–≤ UI):
>>> frappe.msgprint("Operation completed successfully")
```

---

### 7.4 –†–∞–±–æ—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

#### 7.4.1 frappe.db.get_default()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```python
>>> frappe.db.get_default("currency")
'USD'

>>> frappe.db.get_default("language")
'en'
```

---

#### 7.4.2 frappe.db.set_default()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```python
>>> frappe.db.set_default("currency", "EUR")
```

---

### 7.5 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 7.5.1 frappe.cache()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–†–∞–±–æ—Ç–∞ —Å Redis –∫—ç—à–µ–º.

```python
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ:
>>> frappe.cache().set_value("my_key", "my_value")

# –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ:
>>> value = frappe.cache().get_value("my_key")

# –£–¥–∞–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ:
>>> frappe.cache().delete_value("my_key")

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏):
>>> frappe.cache().setex("temp_key", "value", 300)  # 300 —Å–µ–∫—É–Ω–¥
```

---

### 7.6 Enqueue (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)

#### 7.6.1 frappe.enqueue()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

```python
# –ü—Ä–æ—Å—Ç–æ–π –≤—ã–∑–æ–≤:
>>> frappe.enqueue('myapp.tasks.send_emails')

# –° –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏:
>>> frappe.enqueue(
...     'myapp.tasks.process_data',
...     queue='long',
...     timeout=3600,
...     data={'items': [1, 2, 3]}
... )
```

**–û—á–µ—Ä–µ–¥–∏:**
- `short` ‚Äî –±—ã—Å—Ç—Ä—ã–µ –∑–∞–¥–∞—á–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `default` ‚Äî –æ–±—ã—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `long` ‚Äî –¥–æ–ª–≥–∏–µ –∑–∞–¥–∞—á–∏

---

### 7.7 –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π (Realtime)

#### 7.7.1 frappe.publish_realtime()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä —á–µ—Ä–µ–∑ WebSocket.

```python
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º:
>>> frappe.publish_realtime('custom_event', {'message': 'Hello'})

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
>>> frappe.publish_realtime(
...     'notification',
...     {'message': 'Task completed'},
...     user='john@example.com'
... )
```

---

### 7.8 –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏

#### 7.8.1 frappe.get_doc() –¥–ª—è —Ñ–∞–π–ª–æ–≤

```python
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
>>> file_doc = frappe.get_doc({
...     'doctype': 'File',
...     'file_name': 'test.txt',
...     'content': 'Hello World',
...     'is_private': 1
... })
>>> file_doc.save()
```

---

### 7.9 –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è –∏ utils

#### 7.9.1 frappe.scrub()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ snake_case.

```python
>>> frappe.scrub("My Custom Field")
'my_custom_field'
```

#### 7.9.2 frappe.unscrub()

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å snake_case –≤ Title Case.

```python
>>> frappe.unscrub("my_custom_field")
'My Custom Field'
```

---

### 7.10 –†–∞–±–æ—Ç–∞ —Å JSON

#### 7.10.1 frappe.as_json()

```python
>>> data = {'name': 'Test', 'value': 123}
>>> json_str = frappe.as_json(data)
>>> print(json_str)  # '{"name": "Test", "value": 123}'
```

#### 7.10.2 frappe.parse_json()

```python
>>> json_str = '{"name": "Test"}'
>>> data = frappe.parse_json(json_str)
>>> print(data['name'])  # 'Test'
```

---

## 8. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —á–µ–∫-–ª–∏—Å—Ç—ã

### 8.1 –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Å–∫—Ä–∏–ø—Ç–∞

**–ü–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø DocType (–æ–±—ã—á–Ω—ã–π –∏–ª–∏ Tree)
- [ ] –ï—Å–ª–∏ Tree: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ (—Ä–æ–¥–∏—Ç–µ–ª–∏ –ü–ï–†–ï–î –¥–µ—Ç—å–º–∏)
- [ ] –°–¥–µ–ª–∞—Ç—å backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

**–í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å (print –∏–ª–∏ logger)
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ (try/except)
- [ ] –î–µ–ª–∞—Ç—å commit —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–Ω–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ignore_permissions=True` –≥–¥–µ –Ω—É–∂–Ω–æ

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ UI
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Error Log –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å fixtures (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 8.2 –®–∞–±–ª–æ–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

```python
import frappe
import traceback

def universal_import(doctype, data_source):
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
    
    Args:
        doctype: str - –ò–º—è DocType
        data_source: list - –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏
    """
    print(f"Starting import for {doctype}...")
    print(f"Total records: {len(data_source)}")
    
    stats = {"success": 0, "skipped": 0, "errors": 0}
    
    for idx, item in enumerate(data_source, 1):
        try:
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
            if frappe.db.exists(doctype, item.get("name")):
                print(f"  [{idx}/{len(data_source)}] Skipped: {item.get('name')} (already exists)")
                stats["skipped"] += 1
                continue
            
            # –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
            doc = frappe.get_doc({
                "doctype": doctype,
                **item
            })
            doc.insert(ignore_permissions=True)
            
            stats["success"] += 1
            print(f"  [{idx}/{len(data_source)}] Created: {doc.name}")
            
            # Commit –∫–∞–∂–¥—ã–µ 10 –∑–∞–ø–∏—Å–µ–π
            if stats["success"] % 10 == 0:
                frappe.db.commit()
                
        except Exception as e:
            stats["errors"] += 1
            error_msg = f"Error creating {item.get('name')}: {str(e)}"
            print(f"  [{idx}/{len(data_source)}] ‚ùå {error_msg}")
            
            # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ Error Log
            frappe.log_error(
                title=f"{doctype} Import Error",
                message=f"{error_msg}\n\n{traceback.format_exc()}"
            )
            
            # Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
            frappe.db.rollback()
    
    # –§–∏–Ω–∞–ª—å–Ω—ã–π commit
    frappe.db.commit()
    
    # –í—ã–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    print("\n" + "="*50)
    print(f"Import completed for {doctype}")
    print(f"‚úÖ Success: {stats['success']}")
    print(f"‚ö†Ô∏è  Skipped: {stats['skipped']}")
    print(f"‚ùå Errors: {stats['errors']}")
    print("="*50)
```

### 8.3 ORM vs SQL: –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ORM | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQL |
|----------|----------------|----------------|
| –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ | ‚úÖ `frappe.get_doc().insert()` | ‚ùå |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ | ‚úÖ `doc.save()` | ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –ø–æ–ª–µ–π |
| –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ | ‚úÖ `frappe.delete_doc()` | ‚ùå |
| –ú–∞—Å—Å–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ | ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ | ‚úÖ `frappe.db.sql()` |
| –ê–≥—Ä–µ–≥–∞—Ü–∏—è (COUNT, SUM) | ‚ùå | ‚úÖ `frappe.db.sql()` |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è | ‚úÖ `frappe.db.exists()` | ‚úÖ –û–±–∞ –ø–æ–¥—Ö–æ–¥—è—Ç |

**–ü—Ä–∏–º–µ—Ä ORM (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤):**
```python
# –°–æ–∑–¥–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Ö—É–∫–∞–º–∏
doc = frappe.get_doc({"doctype": "User", "email": "test@example.com"})
doc.insert()  # ‚Üê –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é, before_insert, after_insert
```

**–ü—Ä–∏–º–µ—Ä SQL (–¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏):**
```python
# –ú–∞—Å—Å–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –±–µ–∑ ORM overhead
users = frappe.db.sql("""
    SELECT name, email, enabled
    FROM `tabUser`
    WHERE enabled = 1
""", as_dict=True)
```

---

## 9. –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### 9.1 –ò–º–ø–æ—Ä—Ç Folder Structure Templates (Tree DocType)

```python
import frappe
import json

def import_fst_from_json(json_file_path):
    """
    –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å FST –∏–∑ JSON –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
    
    Args:
        json_file_path: str - –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É
    """
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    with open(json_file_path, 'r') as f:
        data = json.load(f)
    
    print(f"Loaded {len(data)} FST records")
    
    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ —É—Ä–æ–≤–Ω—è–º (level_0, level_1, ...)
    levels = {}
    for record in data:
        level = determine_level(record)
        if level not in levels:
            levels[level] = []
        levels[level].append(record)
    
    # –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ —É—Ä–æ–≤–Ω—è–º
    for level in sorted(levels.keys()):
        print(f"\nProcessing Level {level} ({len(levels[level])} records)...")
        
        for record in levels[level]:
            create_fst(record)
        
        # Commit –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
        frappe.db.commit()
        print(f"‚úÖ Level {level} completed")

def determine_level(record):
    """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏"""
    parent = record.get("parent_folder_structure_template")
    if not parent:
        return 0
    
    # –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ä–æ–¥–∏—Ç–µ–ª–µ–π
    level = 1
    current_parent = parent
    
    while current_parent:
        parent_doc = frappe.get_doc("Folder Structure Template", current_parent)
        current_parent = parent_doc.parent_folder_structure_template
        level += 1
    
    return level

def create_fst(data):
    """–°–æ–∑–¥–∞—Ç—å –æ–¥–∏–Ω FST"""
    if not frappe.db.exists("Folder Structure Template", data["name"]):
        doc = frappe.get_doc({
            "doctype": "Folder Structure Template",
            **data
        })
        doc.insert(ignore_permissions=True)
        print(f"  Created: {doc.name}")
```

### 9.2 –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```python
import frappe

def cleanup_and_recreate(doctype, json_data):
    """
    –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    
    Args:
        doctype: str - –ò–º—è DocType
        json_data: list - –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    """
    print(f"Step 1: Deleting all {doctype} records...")
    
    # –ï—Å–ª–∏ Tree DocType - —É–¥–∞–ª—è—Ç—å –ø–æ rgt DESC
    is_tree = frappe.db.get_value("DocType", doctype, "is_tree")
    
    if is_tree:
        records = frappe.db.sql(f"""
            SELECT name FROM `tab{doctype}`
            ORDER BY rgt DESC
        """, as_dict=True)
    else:
        records = frappe.get_all(doctype, fields=["name"])
    
    for record in records:
        frappe.delete_doc(doctype, record.name, force=1, ignore_permissions=True)
    
    frappe.db.commit()
    print(f"‚úÖ Deleted {len(records)} records")
    
    print(f"\nStep 2: Creating {len(json_data)} new records...")
    
    for item in json_data:
        doc = frappe.get_doc({
            "doctype": doctype,
            **item
        })
        doc.insert(ignore_permissions=True)
    
    frappe.db.commit()
    print(f"‚úÖ Created {len(json_data)} records")
```

### 9.3 –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º

```python
import frappe

def validate_before_import(doctype, data):
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
    
    Returns:
        tuple: (is_valid, errors)
    """
    errors = []
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    required_fields = get_required_fields(doctype)
    
    for idx, record in enumerate(data):
        for field in required_fields:
            if not record.get(field):
                errors.append(f"Record {idx+1}: Missing required field '{field}'")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –î–ª—è Tree DocType - –ø–æ—Ä—è–¥–æ–∫ —Ä–æ–¥–∏—Ç–µ–ª–µ–π
    is_tree = frappe.db.get_value("DocType", doctype, "is_tree")
    
    if is_tree:
        created = set()
        parent_field = f"parent_{doctype.lower().replace(' ', '_')}"
        
        for idx, record in enumerate(data):
            name = record.get("name")
            parent = record.get(parent_field)
            
            if parent and parent not in created:
                errors.append(
                    f"Record {idx+1} ({name}): "
                    f"Parent '{parent}' not created yet. Wrong order!"
                )
            
            created.add(name)
    
    is_valid = len(errors) == 0
    return is_valid, errors

def get_required_fields(doctype):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π DocType"""
    fields = frappe.get_meta(doctype).fields
    return [f.fieldname for f in fields if f.reqd]
```

---

## 10. –ú–æ–¥–µ–ª—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π Frappe

### 10.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ commit –∏ rollback

Frappe —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É–º–Ω—É—é –º–æ–¥–µ–ª—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ø–æ—ç—Ç–æ–º—É –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —Ä—É—á–Ω–æ–π commit –ù–ï –Ω—É–∂–µ–Ω.

#### 10.1.1 Web –∑–∞–ø—Ä–æ—Å—ã

**POST / PUT –∑–∞–ø—Ä–æ—Å—ã:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `commit()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `rollback()` –ø—Ä–∏ –ª—é–±–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–∏
- ‚ö†Ô∏è AJAX –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `frappe.call` –∏—Å–ø–æ–ª—å–∑—É—é—Ç POST –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**GET –∑–∞–ø—Ä–æ—Å—ã:**
- ‚ùå –ù–ï –¥–µ–ª–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π commit
- –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä:**
```python
# –í whitelisted –º–µ—Ç–æ–¥–µ:
@frappe.whitelist()
def create_task(title):
    doc = frappe.get_doc({'doctype': 'Task', 'title': title})
    doc.insert()
    # –ù–ï –ù–£–ñ–ù–û: frappe.db.commit()
    # Frappe —Å–¥–µ–ª–∞–µ—Ç commit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    return doc.name
```

---

#### 10.1.2 –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Background Jobs)

**–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ frappe.enqueue():**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `commit()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `rollback()` –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```python
def background_task(items):
    for item in items:
        doc = frappe.get_doc({'doctype': 'Item', **item})
        doc.insert()
    # –ù–ï –ù–£–ñ–ù–û: frappe.db.commit()
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π commit –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

---

#### 10.1.3 Scheduled Jobs (Cron –∑–∞–¥–∞—á–∏)

**–ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `commit()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `rollback()` –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏

---

#### 10.1.4 Patches (–º–∏–≥—Ä–∞—Ü–∏–∏)

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–µ–π:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `commit()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `execute()`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `rollback()` –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏

---

#### 10.1.5 Unit Tests

**–í–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤:**
- Commit –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è (—Ñ–∞–π–ª–∞)
- Commit –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- –í—ã—Ö–æ–¥ –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ (–±–µ–∑ commit)

---

### 10.2 –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Ä—É—á–Ω–æ–π commit

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–π—Ç–µ —Ä—É—á–Ω–æ–π commit –≤:**

1. **bench console:**
```python
>>> doc.insert()
>>> frappe.db.commit()  # ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
```

2. **bench execute —Å–∫—Ä–∏–ø—Ç–∞—Ö:**
```python
def my_script():
    doc.insert()
    frappe.db.commit()  # ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
```

3. **Standalone Python —Å–∫—Ä–∏–ø—Ç–∞—Ö:**
```python
import frappe
frappe.init(site='localhost')
frappe.connect()

doc.insert()
frappe.db.commit()  # ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
```

4. **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ commit –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
```python
for i in range(1000):
    doc = frappe.get_doc({...})
    doc.insert()
    
    if i % 100 == 0:
        frappe.db.commit()  # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø–∏—Å–µ–π
```

---

### 10.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –≤—ã –æ—Ç–≤–µ—á–∞–µ—Ç–µ –∑–∞ rollback!

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
try:
    doc.insert()
except Exception as e:
    print(f"Error: {e}")
    # Frappe –Ω–µ –∑–Ω–∞–µ—Ç –æ–± –æ—à–∏–±–∫–µ!
    # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞!

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
try:
    doc.insert()
    frappe.db.commit()
except Exception as e:
    frappe.db.rollback()  # –Ø–≤–Ω—ã–π rollback
    print(f"Error: {e}")
    raise  # Re-raise –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

---

### 10.4 Savepoints –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ savepoints:**

```python
# –°–æ–∑–¥–∞—Ç—å 100 –∑–∞–ø–∏—Å–µ–π, –æ—Ç–∫–∞—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ
for i in range(100):
    savepoint_name = f"record_{i}"
    frappe.db.savepoint(savepoint_name)
    
    try:
        doc = frappe.get_doc({'doctype': 'Item', 'name': f'ITEM-{i}'})
        doc.insert()
    except Exception as e:
        # –û—Ç–∫–∞—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç—É –∑–∞–ø–∏—Å—å
        frappe.db.rollback(save_point=savepoint_name)
        print(f"Failed: {i}")

# –§–∏–Ω–∞–ª—å–Ω—ã–π commit –≤—Å–µ—Ö —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
frappe.db.commit()
```

**–í–ù–ò–ú–ê–ù–ò–ï:** Rollback –∫ savepoint –ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ email
- –í–Ω–µ—à–Ω–∏–µ API –≤—ã–∑–æ–≤—ã

---

### 10.5 Transaction Hooks ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏:**

```python
class MyDocument(Document):
    def on_update(self):
        # –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
        self.create_pdf_file()
        
        # –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ø—Ä–∏ rollback
        frappe.db.after_rollback.add(self.cleanup_files)
    
    def create_pdf_file(self):
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF
        file_path = f"/tmp/{self.name}.pdf"
        generate_pdf(file_path)
        self._temp_file = file_path
    
    def cleanup_files(self):
        # –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –µ—Å–ª–∏ rollback
        if hasattr(self, '_temp_file'):
            os.remove(self._temp_file)
```

**–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ commit:**

```python
def send_email_after_commit(doc):
    def send():
        frappe.sendmail(
            recipients=[doc.email],
            subject="Document Created",
            message=f"Document {doc.name} was created"
        )
    
    # Email –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞
    frappe.db.after_commit.add(send)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
doc = frappe.get_doc({'doctype': 'Task', 'title': 'New'})
doc.insert()
send_email_after_commit(doc)
frappe.db.commit()
```

---

## 11. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —Å—Å—ã–ª–∫–∏

### 11.1 –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Frappe

**–û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:**
- **Frappe Commands Reference:**  
  https://docs.frappe.io/framework/user/en/bench/frappe-commands
  - `bench console` ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å (—Å –æ–ø—Ü–∏–µ–π --autoreload)
  - `bench execute` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
  - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ site commands, scheduler commands, utility commands

- **Database API Reference:**  
  https://docs.frappe.io/framework/v15/user/en/api/database
  - `frappe.db.get_list()`, `get_all()`, `get_value()`
  - `frappe.db.set_value()`, `exists()`, `count()`
  - `frappe.db.sql()` ‚Äî –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
  - Transaction model –∏ hooks

- **Document API Reference:**  
  https://docs.frappe.io/framework/v15/user/en/api/document
  - `frappe.get_doc()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  - `doc.insert()`, `save()`, `delete()`, `reload()`
  - `doc.db_set()`, `append()`, –º–µ—Ç–æ–¥—ã –¥–ª—è Tree DocTypes

- **NestedSet Implementation (v15):**  
  https://github.com/frappe/frappe/blob/version-15/frappe/utils/nestedset.py
  - –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Tree DocType –ª–æ–≥–∏–∫–∏
  - –ú–µ—Ç–æ–¥—ã: `rebuild_tree()`, `validate_loop()`, `update_nsm()`
  - –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–π: `parent_{scrubbed_doctype}` –∏–ª–∏ `nsm_parent_field`

### 11.2 –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ ERPNext v15

**–í–µ—Ä—Å–∏—è Frappe Framework:** v15.x  
**–í–µ—Ä—Å–∏—è ERPNext:** v15.x

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è v15:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `parent_field` –≤ `rebuild_tree()` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –≤ v16)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –Ω–∞—Ä—è–¥—É —Å MariaDB
- `frappe.db.multisql()` –¥–ª—è –∫—Ä–æ—Å—Å-–°–£–ë–î –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å hooks
- Transaction savepoints –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ rollback
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ user permissions cache –≤ Tree DocTypes

**Tree DocTypes –≤ ERPNext v15:**
- Account (Accounts)
- Cost Center (Cost Centers)
- Item Group (Stock)
- Territory (Selling)
- Sales Person (Selling)
- Customer Group (Selling)
- Supplier Group (Buying)
- Department (HR)

### 11.3 Tree DocType –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **Frappe GitHub - NestedSet (v15):**  
  https://github.com/frappe/frappe/blob/version-15/frappe/utils/nestedset.py
  - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
  - –ü—Ä–∞–≤–∏–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è Tree DocTypes
  > "When importing tree data, ensure that parent nodes are created before their children"

- **Frappe GitHub Wiki:**  
  https://github.com/frappe/frappe/wiki
  - Community documentation –∏ best practices

### 11.4 –°–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —Ñ–æ—Ä—É–º—ã

- **Frappe Forum:**  
  https://discuss.frappe.io/
  - –†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã –∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

- **Stack Overflow - Frappe:**  
  https://stackoverflow.com/questions/tagged/frappe

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `bench execute` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏** ‚Äî —ç—Ç–æ —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –º–µ—Ç–æ–¥
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `bench console` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏** ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞
3. **–í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ `frappe.db.commit()`** ‚Äî –∏–Ω–∞—á–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è
4. **–î–ª—è Tree DocTypes —Å–æ–±–ª—é–¥–∞–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫** ‚Äî —Ä–æ–¥–∏—Ç–µ–ª–∏ –ü–ï–†–ï–î –¥–µ—Ç—å–º–∏
5. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ try/except –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
6. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ heredoc —Å bench console** ‚Äî —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∞–≤–∏–ª–æ –±–æ–ª—å—à–æ–≥–æ –ø–∞–ª—å—Ü–∞

```python
# ‚úÖ –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (—Å–∫—Ä–∏–ø—Ç—ã, –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö):
bench --site localhost execute module.function

# ‚úÖ –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
bench --site localhost console

# ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞–π—Ç–µ:
bench --site localhost console << 'EOF'
# ... –∫–æ–¥ ...
EOF
```

---

---

## 12. –†–∞–±–æ—Ç–∞ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏

### 12.1 –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ Docker exec

**–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —á–µ—Ä–µ–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**

```bash
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: bench console
docker exec -it backend bench --site localhost console

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: bench execute
docker exec backend bench --site localhost execute myapp.scripts.import_data.run

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: heredoc —Å console (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å IPython)
docker exec backend bench --site localhost console << 'EOF'
print("Hello")
EOF
```

### 12.2 –ü–µ—Ä–µ–¥–∞—á–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ Docker

**–ú–µ—Ç–æ–¥ 1: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ apps/**
```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker cp my_script.py backend:/home/frappe/frappe-bench/apps/myapp/myapp/scripts/

# –í—ã–ø–æ–ª–Ω–∏—Ç—å
docker exec backend bench --site localhost execute myapp.scripts.my_script.main
```

**–ú–µ—Ç–æ–¥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å python -c (–¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫–æ–º–∞–Ω–¥)**
```bash
# –ö–æ—Ä–æ—Ç–∫–∏–µ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
docker exec backend bash -c "cd /home/frappe/frappe-bench && \
  bench --site localhost run python -c \
  'import frappe; frappe.init(\"localhost\"); frappe.connect(); \
   print(frappe.db.count(\"User\")); frappe.db.commit()'"
```

**–ú–µ—Ç–æ–¥ 3: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å volume —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏**
```yaml
# docker-compose.yml
services:
  backend:
    volumes:
      - ./scripts:/home/frappe/scripts:ro
```

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
docker exec backend bash -c "cd /home/frappe/frappe-bench && \
  bench --site localhost run python /home/frappe/scripts/import.py"
```

### 12.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Docker

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ sites
docker exec backend ls -la sites/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ apps
docker exec backend bench --site localhost list-apps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏–∏
docker exec backend bench version

# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker exec -it backend bash
cd /home/frappe/frappe-bench
bench --site localhost console
```

### 12.4 –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –≤ Docker

**–û—à–∏–±–∫–∞ 1: Permission denied**
```bash
# –†–µ—à–µ–Ω–∏–µ: –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker exec -u frappe backend bench --site localhost console
```

**–û—à–∏–±–∫–∞ 2: Site not found**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º—è site (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ localhost)
docker exec backend ls sites/
docker exec backend bench --site <correct_site_name> console
```

**–û—à–∏–±–∫–∞ 3: Apps not found**
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ app —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
docker exec backend bench --site localhost list-apps

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å app –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
docker exec backend bench --site localhost install-app <app_name>
```

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 2025-11-25  
**–í–µ—Ä—Å–∏—è:** 1.1  
**–ü—Ä–∏–º–µ–Ω–∏–º–æ –∫:** Frappe Framework v15.x / ERPNext v15.x  
**Docker:** –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å frappe/erpnext:v15  
**–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫:** `docs/guides/PYTHON_INTERACTIVE_GUIDE.md`
